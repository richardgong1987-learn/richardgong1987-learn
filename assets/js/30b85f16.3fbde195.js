(self.webpackChunkrichardgong_1987_learn=self.webpackChunkrichardgong_1987_learn||[]).push([[710],{3905:function(n,e,t){"use strict";t.d(e,{Zo:function(){return d},kt:function(){return m}});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function c(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},l=Object.keys(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var i=a.createContext({}),p=function(n){var e=a.useContext(i),t=e;return n&&(t="function"==typeof n?n(e):o(o({},e),n)),t},d=function(n){var e=p(n.components);return a.createElement(i.Provider,{value:e},n.children)},s={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},u=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,l=n.originalType,i=n.parentName,d=c(n,["components","mdxType","originalType","parentName"]),u=p(t),m=r,h=u["".concat(i,".").concat(m)]||u[m]||s[m]||l;return t?a.createElement(h,o(o({ref:e},d),{},{components:t})):a.createElement(h,o({ref:e},d))}));function m(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var l=t.length,o=new Array(l);o[0]=u;var c={};for(var i in e)hasOwnProperty.call(e,i)&&(c[i]=e[i]);c.originalType=n,c.mdxType="string"==typeof n?n:r,o[1]=c;for(var p=2;p<l;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},6703:function(n,e,t){"use strict";t.r(e),t.d(e,{frontMatter:function(){return c},contentTitle:function(){return i},metadata:function(){return p},toc:function(){return d},default:function(){return u}});var a=t(2122),r=t(9756),l=(t(7294),t(3905)),o=["components"],c={},i="ThreadLocal\u5168\u9762\u89e3\u6790",p={unversionedId:"a-java/a-java-concurrent/threadlocal",id:"a-java/a-java-concurrent/threadlocal",isDocsHomePage:!1,title:"ThreadLocal\u5168\u9762\u89e3\u6790",description:"\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49.ppt",source:"@site/docs/a-java/a-java-concurrent/threadlocal.md",sourceDirName:"a-java/a-java-concurrent",slug:"/a-java/a-java-concurrent/threadlocal",permalink:"/richardgong1987-learn/docs/a-java/a-java-concurrent/threadlocal",editUrl:"https://github.com/richardgong1987-learn/richardgong1987-learn/edit/master/website/docs/a-java/a-java-concurrent/threadlocal.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"NIO\u5b66\u4e60",permalink:"/richardgong1987-learn/docs/a-java/a-java-concurrent/nio"},next:{title:"\u7ebf\u7a0b\u6c60\u5b66\u4e60",permalink:"/richardgong1987-learn/docs/a-java/a-java-concurrent/threadpool"}},d=[{value:"\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49.ppt",id:"\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49ppt",children:[]},{value:"\u90d1\u5dde\u6821\u533a-\u5f20\u5b66\u5168-\u7ebf\u7a0b\u6c60\u7814\u53d1\u5927\u7eb2_v2019-11-21.xmind",id:"\u90d1\u5dde\u6821\u533a-\u5f20\u5b66\u5168-\u7ebf\u7a0b\u6c60\u7814\u53d1\u5927\u7eb2_v2019-11-21xmind",children:[]},{value:"1. ThreadLocal\u4ecb\u7ecd",id:"1-threadlocal\u4ecb\u7ecd",children:[{value:"1.1 \u5b98\u65b9\u4ecb\u7ecd",id:"11-\u5b98\u65b9\u4ecb\u7ecd",children:[]},{value:"1.2 \u57fa\u672c\u4f7f\u7528",id:"12-\u57fa\u672c\u4f7f\u7528",children:[]},{value:"1.3 ThreadLocal\u7c7b\u4e0esynchronized\u5173\u952e\u5b57",id:"13-threadlocal\u7c7b\u4e0esynchronized\u5173\u952e\u5b57",children:[]}]},{value:"2. \u8fd0\u7528\u573a\u666f_\u4e8b\u52a1\u6848\u4f8b",id:"2-\u8fd0\u7528\u573a\u666f_\u4e8b\u52a1\u6848\u4f8b",children:[{value:"2.1 \u8f6c\u8d26\u6848\u4f8b",id:"21-\u8f6c\u8d26\u6848\u4f8b",children:[]},{value:"2.2  \u5e38\u89c4\u89e3\u51b3\u65b9\u6848",id:"22--\u5e38\u89c4\u89e3\u51b3\u65b9\u6848",children:[]},{value:"2.3 ThreadLocal\u89e3\u51b3\u65b9\u6848",id:"23-threadlocal\u89e3\u51b3\u65b9\u6848",children:[]}]},{value:"3. ThreadLocal\u7684\u5185\u90e8\u7ed3\u6784",id:"3-threadlocal\u7684\u5185\u90e8\u7ed3\u6784",children:[{value:"3.1  \u5e38\u89c1\u7684\u8bef\u89e3",id:"31--\u5e38\u89c1\u7684\u8bef\u89e3",children:[]},{value:"3.2  \u73b0\u5728\u7684\u8bbe\u8ba1",id:"32--\u73b0\u5728\u7684\u8bbe\u8ba1",children:[]},{value:"3.3 \u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904",id:"33-\u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904",children:[]}]},{value:"4. ThreadLocal\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801",id:"4-threadlocal\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801",children:[{value:"4.1 set\u65b9\u6cd5",id:"41-set\u65b9\u6cd5",children:[]},{value:"4.2 get\u65b9\u6cd5",id:"42-get\u65b9\u6cd5",children:[]},{value:"4.3 remove\u65b9\u6cd5",id:"43-remove\u65b9\u6cd5",children:[]},{value:"<strong>4.4 initialValue\u65b9\u6cd5</strong>",id:"44-initialvalue\u65b9\u6cd5",children:[]}]},{value:"5. ThreadLocalMap\u6e90\u7801\u5206\u6790",id:"5-threadlocalmap\u6e90\u7801\u5206\u6790",children:[{value:"5.1 \u57fa\u672c\u7ed3\u6784",id:"51-\u57fa\u672c\u7ed3\u6784",children:[]},{value:"5.2 \u5f31\u5f15\u7528\u548c\u5185\u5b58\u6cc4\u6f0f",id:"52-\u5f31\u5f15\u7528\u548c\u5185\u5b58\u6cc4\u6f0f",children:[]},{value:"5.3 hash\u51b2\u7a81\u7684\u89e3\u51b3",id:"53-hash\u51b2\u7a81\u7684\u89e3\u51b3",children:[]}]}],s={toc:d};function u(n){var e=n.components,c=(0,r.Z)(n,o);return(0,l.kt)("wrapper",(0,a.Z)({},s,c,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"threadlocal\u5168\u9762\u89e3\u6790"},"ThreadLocal\u5168\u9762\u89e3\u6790"),(0,l.kt)("h2",{id:"\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49ppt"},(0,l.kt)("a",{target:"_blank",href:t(2452).Z},"\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49.ppt")),(0,l.kt)("h2",{id:"\u90d1\u5dde\u6821\u533a-\u5f20\u5b66\u5168-\u7ebf\u7a0b\u6c60\u7814\u53d1\u5927\u7eb2_v2019-11-21xmind"},(0,l.kt)("a",{target:"_blank",href:t(8456).Z},"\u90d1\u5dde\u6821\u533a-\u5f20\u5b66\u5168-\u7ebf\u7a0b\u6c60\u7814\u53d1\u5927\u7eb2_v2019-11-21.xmind")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e86\u89e3ThreadLocal\u7684\u4ecb\u7ecd")," "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u638c\u63e1ThreadLocal\u7684\u8fd0\u7528\u573a\u666f")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e86\u89e3ThreadLocal\u7684\u5185\u90e8\u7ed3\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e86\u89e3ThreadLocal\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u4e86\u89e3ThreadLocalMap\u7684\u6e90\u7801"))),(0,l.kt)("h2",{id:"1-threadlocal\u4ecb\u7ecd"},"1. ThreadLocal\u4ecb\u7ecd"),(0,l.kt)("h3",{id:"11-\u5b98\u65b9\u4ecb\u7ecd"},"1.1 \u5b98\u65b9\u4ecb\u7ecd"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n * This class provides thread-local variables.  These variables differ from\n * their normal counterparts in that each thread that accesses one (via its\n * {@code get} or {@code set} method) has its own, independently initialized\n * copy of the variable.  {@code ThreadLocal} instances are typically private\n * static fields in classes that wish to associate state with a thread (e.g.,\n * a user ID or Transaction ID).\n *\n * <p>For example, the class below generates unique identifiers local to each\n * thread.\n * A thread's id is assigned the first time it invokes {@code ThreadId.get()}\n * and remains unchanged on subsequent calls.\n * <pre>\n * import java.util.concurrent.atomic.AtomicInteger;\n *\n * public class ThreadId {\n *     // Atomic integer containing the next thread ID to be assigned\n *     private static final AtomicInteger nextId = new AtomicInteger(0);\n *\n *     // Thread local variable containing each thread's ID\n *     private static final ThreadLocal&lt;Integer&gt; threadId =\n *         new ThreadLocal&lt;Integer&gt;() {\n *             &#64;Override protected Integer initialValue() {\n *                 return nextId.getAndIncrement();\n *         }\n *     };\n *\n *     // Returns the current thread's unique ID, assigning it if necessary\n *     public static int get() {\n *         return threadId.get();\n *     }\n * }\n * </pre>\n * <p>Each thread holds an implicit reference to its copy of a thread-local\n * variable as long as the thread is alive and the {@code ThreadLocal}\n * instance is accessible; after a thread goes away, all of its copies of\n * thread-local instances are subject to garbage collection (unless other\n * references to these copies exist).\n *\n * @author  Josh Bloch and Doug Lea\n * @since   1.2\n */\npublic class ThreadLocal<T> {\n    ...\n")),(0,l.kt)("p",null,"\u200b\t\u4eceJava\u5b98\u65b9\u6587\u6863\u4e2d\u7684\u63cf\u8ff0\uff1aThreadLocal\u7c7b\u7528\u6765\u63d0\u4f9b\u7ebf\u7a0b\u5185\u90e8\u7684\u5c40\u90e8\u53d8\u91cf\u3002\u8fd9\u79cd\u53d8\u91cf\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u8bbf\u95ee\uff08\u901a\u8fc7get\u548cset\u65b9\u6cd5\u8bbf\u95ee\uff09\u65f6\u80fd\u4fdd\u8bc1\u5404\u4e2a\u7ebf\u7a0b\u7684\u53d8\u91cf\u76f8\u5bf9\u72ec\u7acb\u4e8e\u5176\u4ed6\u7ebf\u7a0b\u5185\u7684\u53d8\u91cf\u3002ThreadLocal\u5b9e\u4f8b\u901a\u5e38\u6765\u8bf4\u90fd\u662fprivate static\u7c7b\u578b\u7684\uff0c\u7528\u4e8e\u5173\u8054\u7ebf\u7a0b\u548c\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u3002"),(0,l.kt)("p",null,"   \t\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5 ThreadLocal \u7684\u4f5c\u7528\u662f\uff1a\u63d0\u4f9b\u7ebf\u7a0b\u5185\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e4b\u95f4\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u8fd9\u79cd\u53d8\u91cf\u5728\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u5185\u8d77\u4f5c\u7528\uff0c\u51cf\u5c11\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5185\u591a\u4e2a\u51fd\u6570\u6216\u7ec4\u4ef6\u4e4b\u95f4\u4e00\u4e9b\u516c\u5171\u53d8\u91cf\u4f20\u9012\u7684\u590d\u6742\u5ea6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tex"},"\u603b\u7ed3:\n1. \u7ebf\u7a0b\u5e76\u53d1: \u5728\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u573a\u666f\u4e0b\n2. \u4f20\u9012\u6570\u636e: \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7ThreadLocal\u5728\u540c\u4e00\u7ebf\u7a0b\uff0c\u4e0d\u540c\u7ec4\u4ef6\u4e2d\u4f20\u9012\u516c\u5171\u53d8\u91cf\n3. \u7ebf\u7a0b\u9694\u79bb: \u6bcf\u4e2a\u7ebf\u7a0b\u7684\u53d8\u91cf\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\n")),(0,l.kt)("h3",{id:"12-\u57fa\u672c\u4f7f\u7528"},"1.2 \u57fa\u672c\u4f7f\u7528"),(0,l.kt)("h4",{id:"121-\u5e38\u7528\u65b9\u6cd5"},"1.2.1 \u5e38\u7528\u65b9\u6cd5"),(0,l.kt)("p",null,"\u200b\t\u5728\u4f7f\u7528\u4e4b\u524d,\u6211\u4eec\u5148\u6765\u8ba4\u8bc6\u51e0\u4e2aThreadLocal\u7684\u5e38\u7528\u65b9\u6cd5"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u65b9\u6cd5\u58f0\u660e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ThreadLocal()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u521b\u5efaThreadLocal\u5bf9\u8c61")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public void set( T value)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public T get()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public void remove()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u79fb\u9664\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")))),(0,l.kt)("h4",{id:"122-\u4f7f\u7528\u6848\u4f8b"},"1.2.2 \u4f7f\u7528\u6848\u4f8b"),(0,l.kt)("p",null," \t\u6211\u4eec\u6765\u770b\u4e0b\u9762\u8fd9\u4e2a\u6848\u4f8b\t, \u611f\u53d7\u4e00\u4e0bThreadLocal \u7ebf\u7a0b\u9694\u79bb\u7684\u7279\u70b9\uff1a "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class MyDemo {\n    private String content;\n\n    private String getContent() {\n        return content;\n    }\n\n    private void setContent(String content) {\n        this.content = content;\n    }\n\n    public static void main(String[] args) {\n        MyDemo demo = new MyDemo();\n        for (int i = 0; i < 5; i++) {\n            Thread thread = new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    demo.setContent(Thread.currentThread().getName() + "\u7684\u6570\u636e");\n                    System.out.println("-----------------------");\n                    System.out.println(Thread.currentThread().getName() + "---\x3e" + demo.getContent());\n                }\n            });\n            thread.setName("\u7ebf\u7a0b" + i);\n            thread.start();\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\u6253\u5370\u7ed3\u679c:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1574149020726",src:t(2426).Z})),(0,l.kt)("p",null,"\u200b\t\u4ece\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\u591a\u4e2a\u7ebf\u7a0b\u5728\u8bbf\u95ee\u540c\u4e00\u4e2a\u53d8\u91cf\u7684\u65f6\u5019\u51fa\u73b0\u7684\u5f02\u5e38\uff0c\u7ebf\u7a0b\u95f4\u7684\u6570\u636e\u6ca1\u6709\u9694\u79bb\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e0b\u91c7\u7528 ThreadLocal \u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u4f8b\u5b50\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class MyDemo {\n\n    private static ThreadLocal<String> tl = new ThreadLocal<>();\n\n    private String content;\n\n    private String getContent() {\n        return tl.get();\n    }\n\n    private void setContent(String content) {\n         tl.set(content);\n    }\n\n    public static void main(String[] args) {\n        MyDemo demo = new MyDemo();\n        for (int i = 0; i < 5; i++) {\n            Thread thread = new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    demo.setContent(Thread.currentThread().getName() + "\u7684\u6570\u636e");\n                    System.out.println("-----------------------");\n                    System.out.println(Thread.currentThread().getName() + "---\x3e" + demo.getContent());\n                }\n            });\n            thread.setName("\u7ebf\u7a0b" + i);\n            thread.start();\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\u6253\u5370\u7ed3\u679c: "),(0,l.kt)("p",null,"\u200b\t\t\t",(0,l.kt)("img",{alt:"1574149117289",src:t(9204).Z})),(0,l.kt)("p",null,"\u4ece\u7ed3\u679c\u6765\u770b\uff0c\u8fd9\u6837\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u591a\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u9694\u79bb\u7684\u95ee\u9898\uff0c\u5341\u5206\u65b9\u4fbf\u3002"),(0,l.kt)("h3",{id:"13-threadlocal\u7c7b\u4e0esynchronized\u5173\u952e\u5b57"},"1.3 ThreadLocal\u7c7b\u4e0esynchronized\u5173\u952e\u5b57"),(0,l.kt)("h4",{id:"131-synchronized\u540c\u6b65\u65b9\u5f0f"},"1.3.1 synchronized\u540c\u6b65\u65b9\u5f0f"),(0,l.kt)("p",null,"\u200b\t\u8fd9\u91cc\u53ef\u80fd\u6709\u7684\u670b\u53cb\u4f1a\u89c9\u5f97\u5728\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u52a0\u9501\u6765\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u3002\u6211\u4eec\u9996\u5148\u6765\u770b\u4e00\u4e0b\u7528synchronized\u4ee3\u7801\u5757\u5b9e\u73b0\u7684\u6548\u679c:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class Demo02 {\n    \n    private String content;\n\n    public String getContent() {\n        return content;\n    }\n\n    public void setContent(String content) {\n        this.content = content;\n    }\n\n    public static void main(String[] args) {\n        Demo02 demo02 = new Demo02();\n        \n        for (int i = 0; i < 5; i++) {\n            Thread t = new Thread(){\n                @Override\n                public void run() {\n                    synchronized (Demo02.class){\n                        demo02.setContent(Thread.currentThread().getName() + "\u7684\u6570\u636e");\n                        System.out.println("-------------------------------------");\n                        String content = demo02.getContent();\n                        System.out.println(Thread.currentThread().getName() + "---\x3e" + content);\n                    }\n                }\n            };\n            t.setName("\u7ebf\u7a0b" + i);\n            t.start();\n        }\n    }\n}\n')),(0,l.kt)("p",null,"\u6253\u5370\u7ed3\u679c: "),(0,l.kt)("p",null,"\u200b\t\t\t",(0,l.kt)("img",{alt:"1578321788844",src:t(9683).Z})),(0,l.kt)("p",null,"\u200b\t\u4ece\u7ed3\u679c\u53ef\u4ee5\u53d1\u73b0, \u52a0\u9501\u786e\u5b9e\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u5728\u8fd9\u91cc\u6211\u4eec\u5f3a\u8c03\u7684\u662f\u7ebf\u7a0b\u6570\u636e\u9694\u79bb\u7684\u95ee\u9898\uff0c\u5e76\u4e0d\u662f\u591a\u7ebf\u7a0b\u5171\u4eab\u6570\u636e\u7684\u95ee\u9898, \u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\u4f7f\u7528synchronized\u5173\u952e\u5b57\u662f\u4e0d\u5408\u9002\u7684\u3002"),(0,l.kt)("h4",{id:"132-threadlocal\u4e0esynchronized\u7684\u533a\u522b"},"1.3.2 ThreadLocal\u4e0esynchronized\u7684\u533a\u522b"),(0,l.kt)("p",null,"\u200b\t\u867d\u7136ThreadLocal\u6a21\u5f0f\u4e0esynchronized\u5173\u952e\u5b57\u90fd\u7528\u4e8e\u5904\u7406\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u53d8\u91cf\u7684\u95ee\u9898, \u4e0d\u8fc7\u4e24\u8005\u5904\u7406\u95ee\u9898\u7684\u89d2\u5ea6\u548c\u601d\u8def\u4e0d\u540c\u3002"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null}),(0,l.kt)("th",{parentName:"tr",align:null},"synchronized"),(0,l.kt)("th",{parentName:"tr",align:null},"ThreadLocal"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u539f\u7406"),(0,l.kt)("td",{parentName:"tr",align:null},"\u540c\u6b65\u673a\u5236\u91c7\u7528'\u4ee5\u65f6\u95f4\u6362\u7a7a\u95f4'\u7684\u65b9\u5f0f, \u53ea\u63d0\u4f9b\u4e86\u4e00\u4efd\u53d8\u91cf,\u8ba9\u4e0d\u540c\u7684\u7ebf\u7a0b\u6392\u961f\u8bbf\u95ee"),(0,l.kt)("td",{parentName:"tr",align:null},"ThreadLocal\u91c7\u7528'\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4'\u7684\u65b9\u5f0f, \u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u90fd\u63d0\u4f9b\u4e86\u4e00\u4efd\u53d8\u91cf\u7684\u526f\u672c,\u4ece\u800c\u5b9e\u73b0\u540c\u65f6\u8bbf\u95ee\u800c\u76f8\u4e0d\u5e72\u6270")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u4fa7\u91cd\u70b9"),(0,l.kt)("td",{parentName:"tr",align:null},"\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u8bbf\u95ee\u8d44\u6e90\u7684\u540c\u6b65"),(0,l.kt)("td",{parentName:"tr",align:null},"\u591a\u7ebf\u7a0b\u4e2d\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u76f8\u4e92\u9694\u79bb")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-tex"},"\u603b\u7ed3\uff1a \u5728\u521a\u521a\u7684\u6848\u4f8b\u4e2d\uff0c\u867d\u7136\u4f7f\u7528ThreadLocal\u548csynchronized\u90fd\u80fd\u89e3\u51b3\u95ee\u9898,\u4f46\u662f\u4f7f\u7528ThreadLocal\u66f4\u4e3a\u5408\u9002,\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7a0b\u5e8f\u62e5\u6709\u66f4\u9ad8\u7684\u5e76\u53d1\u6027\u3002\n")),(0,l.kt)("h2",{id:"2-\u8fd0\u7528\u573a\u666f_\u4e8b\u52a1\u6848\u4f8b"},"2. \u8fd0\u7528\u573a\u666f_\u4e8b\u52a1\u6848\u4f8b"),(0,l.kt)("p",null,"\u200b\t\u901a\u8fc7\u4ee5\u4e0a\u7684\u4ecb\u7ecd\uff0c\u6211\u4eec\u5df2\u7ecf\u57fa\u672c\u4e86\u89e3ThreadLocal\u7684\u7279\u70b9\u3002\u4f46\u662f\u5b83\u5177\u4f53\u662f\u8fd0\u7528\u5728\u4ec0\u4e48\u573a\u666f\u4e2d\u5462\uff1f \u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u6848\u4f8b\uff1a \u4e8b\u52a1\u64cd\u4f5c\u3002"),(0,l.kt)("h3",{id:"21-\u8f6c\u8d26\u6848\u4f8b"},"2.1 \u8f6c\u8d26\u6848\u4f8b"),(0,l.kt)("h4",{id:"211-\u573a\u666f\u6784\u5efa"},"2.1.1 \u573a\u666f\u6784\u5efa"),(0,l.kt)("p",null,"\u200b\t\u8fd9\u91cc\u6211\u4eec\u5148\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u8f6c\u8d26\u573a\u666f\uff1a \u6709\u4e00\u4e2a\u6570\u636e\u8868account\uff0c\u91cc\u9762\u6709\u4e24\u4e2a\u7528\u6237Jack\u548cRose\uff0c\u7528\u6237Jack  \u7ed9\u7528\u6237Rose \u8f6c\u8d26\u3002 "),(0,l.kt)("p",null,"\u200b\t\u6848\u4f8b\u7684\u5b9e\u73b0\u4e3b\u8981\u7528mysql\u6570\u636e\u5e93\uff0cJDBC \u548c C3P0 \u6846\u67b6\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u4ee3\u7801 \uff1a "),(0,l.kt)("p",null,"\u200b\t\uff081\uff09 \u9879\u76ee\u7ed3\u6784"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1574045241145",src:t(4199).Z})),(0,l.kt)("p",null,"\u200b\t\uff082\uff09 \u6570\u636e\u51c6\u5907"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"-- \u4f7f\u7528\u6570\u636e\u5e93\nuse test;\n-- \u521b\u5efa\u4e00\u5f20\u8d26\u6237\u8868\ncreate table account(\n    id int primary key auto_increment,\n    name varchar(20),\n    money double\n);\n-- \u521d\u59cb\u5316\u6570\u636e\ninsert into account values(null, 'Jack', 1000);\ninsert into account values(null, 'Rose', 0);\n")),(0,l.kt)("p",null,"\u200b\t\uff083\uff09 C3P0\u914d\u7f6e\u6587\u4ef6\u548c\u5de5\u5177\u7c7b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},'<c3p0-config>\n  \x3c!-- \u4f7f\u7528\u9ed8\u8ba4\u7684\u914d\u7f6e\u8bfb\u53d6\u8fde\u63a5\u6c60\u5bf9\u8c61 --\x3e\n  <default-config>\n    \x3c!--  \u8fde\u63a5\u53c2\u6570 --\x3e\n    <property name="driverClass">com.mysql.jdbc.Driver</property>\n    <property name="jdbcUrl">jdbc:mysql://localhost:3306/test</property>\n    <property name="user">root</property>\n    <property name="password">1234</property>\n    \n    \x3c!-- \u8fde\u63a5\u6c60\u53c2\u6570 --\x3e\n    <property name="initialPoolSize">5</property>\n    <property name="maxPoolSize">10</property>\n    <property name="checkoutTimeout">3000</property>\n  </default-config>\n\n</c3p0-config>\n')),(0,l.kt)("p",null,"\u200b    \t\uff084\uff09 \u5de5\u5177\u7c7b \uff1a JdbcUtils"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.itheima.transfer.utils;\n\nimport com.mchange.v2.c3p0.ComboPooledDataSource;\nimport java.sql.Connection;\nimport java.sql.SQLException;\n\npublic class JdbcUtils {\n    // c3p0 \u6570\u636e\u5e93\u8fde\u63a5\u6c60\u5bf9\u8c61\u5c5e\u6027\n    private static final ComboPooledDataSource ds = new ComboPooledDataSource();\n    // \u83b7\u53d6\u8fde\u63a5\n    public static Connection getConnection() throws SQLException {\n        return ds.getConnection();\n    }\n    //\u91ca\u653e\u8d44\u6e90\n    public static void release(AutoCloseable... ios){\n        for (AutoCloseable io : ios) {\n            if(io != null){\n                try {\n                    io.close();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n    \n    \n    public static void commitAndClose(Connection conn) {\n        try {\n            if(conn != null){\n                //\u63d0\u4ea4\u4e8b\u52a1\n                conn.commit();\n                //\u91ca\u653e\u8fde\u63a5\n                conn.close();\n            }\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void rollbackAndClose(Connection conn) {\n        try {\n            if(conn != null){\n                //\u56de\u6eda\u4e8b\u52a1\n                conn.rollback();\n                //\u91ca\u653e\u8fde\u63a5\n                conn.close();\n            }\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\uff085\uff09 dao\u5c42\u4ee3\u7801 \uff1a AccountDao"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.itheima.transfer.dao;\n\nimport com.itheima.transfer.utils.JdbcUtils;\n\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\npublic class AccountDao {\n\n    public void out(String outUser, int money) throws SQLException {\n        String sql = "update account set money = money - ? where name = ?";\n\n        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,outUser);\n        pstm.executeUpdate();\n\n        JdbcUtils.release(pstm,conn);\n    }\n\n    public void in(String inUser, int money) throws SQLException {\n        String sql = "update account set money = money + ? where name = ?";\n\n        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,inUser);\n        pstm.executeUpdate();\n\n        JdbcUtils.release(pstm,conn);\n    }\n}\n')),(0,l.kt)("p",null,"\u200b\t\uff086\uff09 service\u5c42\u4ee3\u7801 \uff1a AccountService"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.itheima.transfer.service;\n\nimport com.itheima.transfer.dao.AccountDao;\nimport java.sql.SQLException;\n\npublic class AccountService {\n\n    public boolean transfer(String outUser, String inUser, int money) {\n        AccountDao ad = new AccountDao();\n        try {\n            // \u8f6c\u51fa\n            ad.out(outUser, money);\n            // \u8f6c\u5165\n            ad.in(inUser, money);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n        return true;\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\uff087\uff09 web\u5c42\u4ee3\u7801 \uff1a AccountWeb"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.itheima.transfer.web;\n\nimport com.itheima.transfer.service.AccountService;\n\npublic class AccountWeb {\n\n    public static void main(String[] args) {\n        // \u6a21\u62df\u6570\u636e : Jack \u7ed9 Rose \u8f6c\u8d26 100\n        String outUser = "Jack";\n        String inUser = "Rose";\n        int money = 100;\n\n        AccountService as = new AccountService();\n        boolean result = as.transfer(outUser, inUser, money);\n\n        if (result == false) {\n            System.out.println("\u8f6c\u8d26\u5931\u8d25!");\n        } else {\n            System.out.println("\u8f6c\u8d26\u6210\u529f!");\n        }\n    }\n}\n')),(0,l.kt)("h4",{id:"212-\u5f15\u5165\u4e8b\u52a1"},"2.1.2 \u5f15\u5165\u4e8b\u52a1"),(0,l.kt)("p",null,"\u200b\t\u6848\u4f8b\u4e2d\u7684\u8f6c\u8d26\u6d89\u53ca\u4e24\u4e2aDML\u64cd\u4f5c\uff1a \u4e00\u4e2a\u8f6c\u51fa\uff0c\u4e00\u4e2a\u8f6c\u5165\u3002\u8fd9\u4e9b\u64cd\u4f5c\u662f\u9700\u8981\u5177\u5907\u539f\u5b50\u6027\u7684\uff0c\u4e0d\u53ef\u5206\u5272\u3002\u4e0d\u7136\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u4fee\u6539\u5f02\u5e38\u60c5\u51b5\u3002  "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"public class AccountService {\n    public boolean transfer(String outUser, String inUser, int money) {\n        AccountDao ad = new AccountDao();\n        try {\n            // \u8f6c\u51fa\n            ad.out(outUser, money);\n            // \u6a21\u62df\u8f6c\u8d26\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38\n            int i = 1/0;\n            // \u8f6c\u5165\n            ad.in(inUser, money);\n        } catch (Exception e) {\n            e.printStackTrace();\n            return false;\n        }\n        return true;\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\u6240\u4ee5\u8fd9\u91cc\u5c31\u9700\u8981\u64cd\u4f5c\u4e8b\u52a1\uff0c\u6765\u4fdd\u8bc1\u8f6c\u51fa\u548c\u8f6c\u5165\u64cd\u4f5c\u5177\u5907\u539f\u5b50\u6027\uff0c\u8981\u4e48\u540c\u65f6\u6210\u529f\uff0c\u8981\u4e48\u540c\u65f6\u5931\u8d25\u3002"),(0,l.kt)("p",null," \uff081\uff09 JDBC\u4e2d\u5173\u4e8e\u4e8b\u52a1\u7684\u64cd\u4f5c\u7684api"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Connection\u63a5\u53e3\u7684\u65b9\u6cd5"),(0,l.kt)("th",{parentName:"tr",align:null},"\u4f5c\u7528"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"void  setAutoCommit(false)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7981\u7528\u4e8b\u52a1\u81ea\u52a8\u63d0\u4ea4\uff08\u6539\u4e3a\u624b\u52a8\uff09")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"void  commit();"),(0,l.kt)("td",{parentName:"tr",align:null},"\u63d0\u4ea4\u4e8b\u52a1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"void rollback();"),(0,l.kt)("td",{parentName:"tr",align:null},"\u56de\u6eda\u4e8b\u52a1")))),(0,l.kt)("p",null,"  ",(0,l.kt)("strong",{parentName:"p"},"\uff082\uff09 \u5f00\u542f\u4e8b\u52a1\u7684\u6ce8\u610f\u70b9:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u4fdd\u8bc1\u6240\u6709\u7684\u64cd\u4f5c\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d,\u6848\u4f8b\u4e2d\u4f7f\u7528\u7684\u8fde\u63a5\u5fc5\u987b\u662f\u540c\u4e00\u4e2a:  service\u5c42\u5f00\u542f\u4e8b\u52a1\u7684connection\u9700\u8981\u8ddfdao\u5c42\u8bbf\u95ee\u6570\u636e\u5e93\u7684connection\u4fdd\u6301\u4e00\u81f4")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u7ebf\u7a0b\u5e76\u53d1\u60c5\u51b5\u4e0b, \u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u64cd\u4f5c\u5404\u81ea\u7684 connection"))),(0,l.kt)("h3",{id:"22--\u5e38\u89c4\u89e3\u51b3\u65b9\u6848"},"2.2  \u5e38\u89c4\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("h4",{id:"221-\u5e38\u89c4\u65b9\u6848\u7684\u5b9e\u73b0"},"2.2.1 \u5e38\u89c4\u65b9\u6848\u7684\u5b9e\u73b0"),(0,l.kt)("p",null,"\u57fa\u4e8e\u4e0a\u9762\u7ed9\u51fa\u7684\u524d\u63d0\uff0c \u5927\u5bb6\u901a\u5e38\u60f3\u5230\u7684\u89e3\u51b3\u65b9\u6848\u662f \uff1a "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f20\u53c2: \u4eceservice\u5c42\u5c06connection\u5bf9\u8c61\u5411dao\u5c42\u4f20\u9012 "),(0,l.kt)("li",{parentName:"ul"},"\u52a0\u9501")),(0,l.kt)("p",null,"\u4ee5\u4e0b\u662f\u4ee3\u7801\u5b9e\u73b0\u4fee\u6539\u7684\u90e8\u5206\uff1a "),(0,l.kt)("p",null,"\u200b\t\uff081 ) AccountService \u7c7b "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.itheima.transfer.service;\n\nimport com.itheima.transfer.dao.AccountDao;\nimport com.itheima.transfer.utils.JdbcUtils;\nimport java.sql.Connection;\n\npublic class AccountService {\n\n    public boolean transfer(String outUser, String inUser, int money) {\n        AccountDao ad = new AccountDao();\n        //\u7ebf\u7a0b\u5e76\u53d1\u60c5\u51b5\u4e0b,\u4e3a\u4e86\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u5404\u81ea\u7684connection,\u6545\u52a0\u9501\n        synchronized (AccountService.class) {\n\n            Connection conn = null;\n            try {\n                conn = JdbcUtils.getConnection();\n                //\u5f00\u542f\u4e8b\u52a1\n                conn.setAutoCommit(false);\n                // \u8f6c\u51fa\n                ad.out(conn, outUser, money);\n                // \u6a21\u62df\u8f6c\u8d26\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38\n//            int i = 1/0;\n                // \u8f6c\u5165\n                ad.in(conn, inUser, money);\n                //\u4e8b\u52a1\u63d0\u4ea4\n                JdbcUtils.commitAndClose(conn);\n            } catch (Exception e) {\n                e.printStackTrace();\n                //\u4e8b\u52a1\u56de\u6eda\n                JdbcUtils.rollbackAndClose(conn);\n                return false;\n            }\n            return true;\n        }\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\uff082) AccountDao \u7c7b \uff08\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a connection\u4e0d\u80fd\u5728dao\u5c42\u91ca\u653e\uff0c\u8981\u5728service\u5c42\uff0c\u4e0d\u7136\u5728dao\u5c42\u91ca\u653e\uff0cservice\u5c42\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86\uff09"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.itheima.transfer.dao;\n\nimport com.itheima.transfer.utils.JdbcUtils;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\npublic class AccountDao {\n\n    public void out(Connection conn, String outUser, int money) throws SQLException{\n        String sql = "update account set money = money - ? where name = ?";\n        //\u6ce8\u91ca\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\u8fde\u63a5\u7684\u4ee3\u7801,\u4f7f\u7528\u4eceservice\u4e2d\u4f20\u9012\u8fc7\u6765\u7684connection\n//        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,outUser);\n        pstm.executeUpdate();\n        //\u8fde\u63a5\u4e0d\u80fd\u5728\u8fd9\u91cc\u91ca\u653e,service\u5c42\u4e2d\u8fd8\u9700\u8981\u4f7f\u7528\n//        JdbcUtils.release(pstm,conn);\n        JdbcUtils.release(pstm);\n    }\n\n    public void in(Connection conn, String inUser, int money) throws SQLException {\n        String sql = "update account set money = money + ? where name = ?";\n//        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,inUser);\n        pstm.executeUpdate();\n//        JdbcUtils.release(pstm,conn);\n        JdbcUtils.release(pstm);\n    }\n}\n')),(0,l.kt)("h4",{id:"222-\u5e38\u89c4\u65b9\u6848\u7684\u5f0a\u7aef"},"2.2.2 \u5e38\u89c4\u65b9\u6848\u7684\u5f0a\u7aef"),(0,l.kt)("p",null,"\u4e0a\u8ff0\u65b9\u5f0f\u6211\u4eec\u770b\u5230\u7684\u786e\u6309\u8981\u6c42\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u4f46\u662f\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u4f1a\u53d1\u73b0\u8fd9\u6837\u5b9e\u73b0\u7684\u5f0a\u7aef\uff1a "),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u76f4\u63a5\u4eceservice\u5c42\u4f20\u9012connection\u5230dao\u5c42, \u9020\u6210\u4ee3\u7801\u8026\u5408\u5ea6\u63d0\u9ad8")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u52a0\u9501\u4f1a\u9020\u6210\u7ebf\u7a0b\u5931\u53bb\u5e76\u53d1\u6027\uff0c\u7a0b\u5e8f\u6027\u80fd\u964d\u4f4e"))),(0,l.kt)("h3",{id:"23-threadlocal\u89e3\u51b3\u65b9\u6848"},"2.3 ThreadLocal\u89e3\u51b3\u65b9\u6848"),(0,l.kt)("h4",{id:"231-threadlocal\u65b9\u6848\u7684\u5b9e\u73b0"},"2.3.1 ThreadLocal\u65b9\u6848\u7684\u5b9e\u73b0"),(0,l.kt)("p",null,"\u50cf\u8fd9\u79cd\u9700\u8981\u5728\u9879\u76ee\u4e2d\u8fdb\u884c",(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e\u4f20\u9012"),"\u548c",(0,l.kt)("strong",{parentName:"p"},"\u7ebf\u7a0b\u9694\u79bb"),"\u7684\u573a\u666f\uff0c\u6211\u4eec\u4e0d\u59a8\u7528ThreadLocal\u6765\u89e3\u51b3\uff1a "),(0,l.kt)("p",null,"\u200b\t\uff081\uff09 \u5de5\u5177\u7c7b\u7684\u4fee\u6539\uff1a \u52a0\u5165ThreadLocal"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.itheima.transfer.utils;\n\nimport com.mchange.v2.c3p0.ComboPooledDataSource;\nimport java.sql.Connection;\nimport java.sql.SQLException;\n\npublic class JdbcUtils {\n    //ThreadLocal\u5bf9\u8c61 : \u5c06connection\u7ed1\u5b9a\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\n    private static final ThreadLocal<Connection> tl = new ThreadLocal();\n\n    // c3p0 \u6570\u636e\u5e93\u8fde\u63a5\u6c60\u5bf9\u8c61\u5c5e\u6027\n    private static final ComboPooledDataSource ds = new ComboPooledDataSource();\n\n    // \u83b7\u53d6\u8fde\u63a5\n    public static Connection getConnection() throws SQLException {\n        //\u53d6\u51fa\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684connection\u5bf9\u8c61\n        Connection conn = tl.get();\n        if (conn == null) {\n            //\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4ece\u8fde\u63a5\u6c60\u4e2d\u53d6\u51fa\n            conn = ds.getConnection();\n            //\u518d\u5c06connection\u5bf9\u8c61\u7ed1\u5b9a\u5230\u5f53\u524d\u7ebf\u7a0b\u4e2d\n            tl.set(conn);\n        }\n        return conn;\n    }\n\n    //\u91ca\u653e\u8d44\u6e90\n    public static void release(AutoCloseable... ios) {\n        for (AutoCloseable io : ios) {\n            if (io != null) {\n                try {\n                    io.close();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    public static void commitAndClose() {\n        try {\n            Connection conn = getConnection();\n            //\u63d0\u4ea4\u4e8b\u52a1\n            conn.commit();\n            //\u89e3\u9664\u7ed1\u5b9a\n            tl.remove();\n            //\u91ca\u653e\u8fde\u63a5\n            conn.close();\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void rollbackAndClose() {\n        try {\n            Connection conn = getConnection();\n            //\u56de\u6eda\u4e8b\u52a1\n            conn.rollback();\n            //\u89e3\u9664\u7ed1\u5b9a\n            tl.remove();\n            //\u91ca\u653e\u8fde\u63a5\n            conn.close();\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\uff082\uff09 AccountService\u7c7b\u7684\u4fee\u6539\uff1a\u4e0d\u9700\u8981\u4f20\u9012connection\u5bf9\u8c61"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"package com.itheima.transfer.service;\n\nimport com.itheima.transfer.dao.AccountDao;\nimport com.itheima.transfer.utils.JdbcUtils;\nimport java.sql.Connection;\n\npublic class AccountService {\n\n    public boolean transfer(String outUser, String inUser, int money) {\n        AccountDao ad = new AccountDao();\n\n        try {\n            Connection conn = JdbcUtils.getConnection();\n            //\u5f00\u542f\u4e8b\u52a1\n            conn.setAutoCommit(false);\n            // \u8f6c\u51fa \uff1a \u8fd9\u91cc\u4e0d\u9700\u8981\u4f20\u53c2\u4e86 \uff01\n            ad.out(outUser, money);\n            // \u6a21\u62df\u8f6c\u8d26\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38\n//            int i = 1 / 0;\n            // \u8f6c\u5165\n            ad.in(inUser, money);\n            //\u4e8b\u52a1\u63d0\u4ea4\n            JdbcUtils.commitAndClose();\n        } catch (Exception e) {\n            e.printStackTrace();\n            //\u4e8b\u52a1\u56de\u6eda\n           JdbcUtils.rollbackAndClose();\n            return false;\n        }\n        return true;\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t\uff083\uff09 AccountDao\u7c7b\u7684\u4fee\u6539\uff1a\u7167\u5e38\u4f7f\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'package com.itheima.transfer.dao;\n\nimport com.itheima.transfer.utils.JdbcUtils;\n\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\npublic class AccountDao {\n\n    public void out(String outUser, int money) throws SQLException {\n        String sql = "update account set money = money - ? where name = ?";\n        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,outUser);\n        pstm.executeUpdate();\n        //\u7167\u5e38\u4f7f\u7528\n//        JdbcUtils.release(pstm,conn);\n        JdbcUtils.release(pstm);\n    }\n\n    public void in(String inUser, int money) throws SQLException {\n        String sql = "update account set money = money + ? where name = ?";\n        Connection conn = JdbcUtils.getConnection();\n        PreparedStatement pstm = conn.prepareStatement(sql);\n        pstm.setInt(1,money);\n        pstm.setString(2,inUser);\n        pstm.executeUpdate();\n//        JdbcUtils.release(pstm,conn);\n        JdbcUtils.release(pstm);\n    }\n}\n')),(0,l.kt)("h4",{id:"232-threadlocal\u65b9\u6848\u7684\u597d\u5904"},"2.3.2 ThreadLocal\u65b9\u6848\u7684\u597d\u5904"),(0,l.kt)("p",null,"\u4ece\u4e0a\u8ff0\u7684\u6848\u4f8b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c \u5728\u4e00\u4e9b\u7279\u5b9a\u573a\u666f\u4e0b\uff0cThreadLocal\u65b9\u6848\u6709\u4e24\u4e2a\u7a81\u51fa\u7684\u4f18\u52bf\uff1a "),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f20\u9012\u6570\u636e \uff1a \u4fdd\u5b58\u6bcf\u4e2a\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u6570\u636e\uff0c\u5728\u9700\u8981\u7684\u5730\u65b9\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6, \u907f\u514d\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u5e26\u6765\u7684\u4ee3\u7801\u8026\u5408\u95ee\u9898")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7ebf\u7a0b\u9694\u79bb \uff1a \u5404\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u76f8\u4e92\u9694\u79bb\u5374\u53c8\u5177\u5907\u5e76\u53d1\u6027\uff0c\u907f\u514d\u540c\u6b65\u65b9\u5f0f\u5e26\u6765\u7684\u6027\u80fd\u635f\u5931"))),(0,l.kt)("h2",{id:"3-threadlocal\u7684\u5185\u90e8\u7ed3\u6784"},"3. ThreadLocal\u7684\u5185\u90e8\u7ed3\u6784"),(0,l.kt)("p",null,"\u200b\t\u901a\u8fc7\u4ee5\u4e0a\u7684\u5b66\u4e60\uff0c\u6211\u4eec\u5bf9ThreadLocal\u7684\u4f5c\u7528\u6709\u4e86\u4e00\u5b9a\u7684\u8ba4\u8bc6\u3002\u73b0\u5728\u6211\u4eec\u4e00\u8d77\u6765\u770b\u4e00\u4e0bThreadLocal\u7684\u5185\u90e8\u7ed3\u6784\uff0c\u63a2\u7a76\u5b83\u80fd\u591f\u5b9e\u73b0\u7ebf\u7a0b\u6570\u636e\u9694\u79bb\u7684\u539f\u7406\u3002"),(0,l.kt)("h3",{id:"31--\u5e38\u89c1\u7684\u8bef\u89e3"},"3.1  \u5e38\u89c1\u7684\u8bef\u89e3"),(0,l.kt)("p",null,"\u200b\t\u5982\u679c\u6211\u4eec\u4e0d\u53bb\u770b\u6e90\u4ee3\u7801\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u731c\u6d4b",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u662f\u8fd9\u6837\u5b50\u8bbe\u8ba1\u7684\uff1a\u6bcf\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u90fd\u521b\u5efa\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Map"),"\uff0c\u7136\u540e\u7528\u7ebf\u7a0b\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Map"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\uff0c\u8981\u5b58\u50a8\u7684\u5c40\u90e8\u53d8\u91cf\u4f5c\u4e3a",(0,l.kt)("inlineCode",{parentName:"p"},"Map"),"\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"value"),"\uff0c\u8fd9\u6837\u5c31\u80fd\u8fbe\u5230\u5404\u4e2a\u7ebf\u7a0b\u7684\u5c40\u90e8\u53d8\u91cf\u9694\u79bb\u7684\u6548\u679c\u3002\u8fd9\u662f\u6700\u7b80\u5355\u7684\u8bbe\u8ba1\u65b9\u6cd5\uff0cJDK\u6700\u65e9\u671f\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal")," \u786e\u5b9e\u662f\u8fd9\u6837\u8bbe\u8ba1\u7684\uff0c\u4f46\u73b0\u5728\u65e9\u5df2\u4e0d\u662f\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1582788729557",src:t(4033).Z})),(0,l.kt)("h3",{id:"32--\u73b0\u5728\u7684\u8bbe\u8ba1"},"3.2  \u73b0\u5728\u7684\u8bbe\u8ba1"),(0,l.kt)("p",null,"\u200b\t\u4f46\u662f\uff0cJDK\u540e\u9762\u4f18\u5316\u4e86\u8bbe\u8ba1\u65b9\u6848\uff0c\u5728JDK8\u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u7684\u8bbe\u8ba1\u662f\uff1a\u6bcf\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Thread"),"\u7ef4\u62a4\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocalMap"),"\uff0c\u8fd9\u4e2aMap\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"key"),"\u662f",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u5b9e\u4f8b\u672c\u8eab\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"value"),"\u624d\u662f\u771f\u6b63\u8981\u5b58\u50a8\u7684\u503c",(0,l.kt)("inlineCode",{parentName:"p"},"Object"),"\u3002"),(0,l.kt)("p",null,"\u5177\u4f53\u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a"),(0,l.kt)("p",null,"\u200b\t\uff081\uff09 \u6bcf\u4e2aThread\u7ebf\u7a0b\u5185\u90e8\u90fd\u6709\u4e00\u4e2aMap (ThreadLocalMap)\n\u200b\t\uff082\uff09 Map\u91cc\u9762\u5b58\u50a8ThreadLocal\u5bf9\u8c61\uff08key\uff09\u548c\u7ebf\u7a0b\u7684\u53d8\u91cf\u526f\u672c\uff08value\uff09\n\u200b\t\uff083\uff09Thread\u5185\u90e8\u7684Map\u662f\u7531ThreadLocal\u7ef4\u62a4\u7684\uff0c\u7531ThreadLocal\u8d1f\u8d23\u5411map\u83b7\u53d6\u548c\u8bbe\u7f6e\u7ebf\u7a0b\u7684\u53d8\u91cf\u503c\u3002\n\u200b\t\uff084\uff09\u5bf9\u4e8e\u4e0d\u540c\u7684\u7ebf\u7a0b\uff0c\u6bcf\u6b21\u83b7\u53d6\u526f\u672c\u503c\u65f6\uff0c\u522b\u7684\u7ebf\u7a0b\u5e76\u4e0d\u80fd\u83b7\u53d6\u5230\u5f53\u524d\u7ebf\u7a0b\u7684\u526f\u672c\u503c\uff0c\u5f62\u6210\u4e86\u526f\u672c\u7684\u9694\u79bb\uff0c\u4e92\u4e0d\u5e72\u6270\u3002\t"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1574155226793",src:t(9361).Z})),(0,l.kt)("h3",{id:"33-\u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904"},"3.3 \u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904"),(0,l.kt)("p",null,"\u200b\t\u8fd9\u4e2a\u8bbe\u8ba1\u4e0e\u6211\u4eec\u4e00\u5f00\u59cb\u8bf4\u7684\u8bbe\u8ba1\u521a\u597d\u76f8\u53cd\uff0c\u8fd9\u6837\u8bbe\u8ba1\u6709\u5982\u4e0b\u4e24\u4e2a\u4f18\u52bf\uff1a"),(0,l.kt)("p",null,"\uff081\uff09 \u8fd9\u6837\u8bbe\u8ba1\u4e4b\u540e\u6bcf\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"Map"),"\u5b58\u50a8\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"Entry"),"\u6570\u91cf\u5c31\u4f1a\u53d8\u5c11\u3002\u56e0\u4e3a\u4e4b\u524d\u7684\u5b58\u50a8\u6570\u91cf\u7531",(0,l.kt)("inlineCode",{parentName:"p"},"Thread"),"\u7684\u6570\u91cf\u51b3\u5b9a\uff0c\u73b0\u5728\u662f\u7531",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocal"),"\u7684\u6570\u91cf\u51b3\u5b9a\u3002\u5728\u5b9e\u9645\u8fd0\u7528\u5f53\u4e2d\uff0c\u5f80\u5f80ThreadLocal\u7684\u6570\u91cf\u8981\u5c11\u4e8eThread\u7684\u6570\u91cf\u3002"),(0,l.kt)("p",null,"\uff082\uff09 \u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"Thread"),"\u9500\u6bc1\u4e4b\u540e\uff0c\u5bf9\u5e94\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"ThreadLocalMap"),"\u4e5f\u4f1a\u968f\u4e4b\u9500\u6bc1\uff0c\u80fd\u51cf\u5c11\u5185\u5b58\u7684\u4f7f\u7528\u3002"),(0,l.kt)("h2",{id:"4-threadlocal\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801"},"4. ThreadLocal\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801"),(0,l.kt)("p",null,"\u200b\t\u57fa\u4e8eThreadLocal\u7684\u5185\u90e8\u7ed3\u6784\uff0c\u6211\u4eec\u7ee7\u7eed\u5206\u6790\u5b83\u7684\u6838\u5fc3\u65b9\u6cd5\u6e90\u7801\uff0c\u66f4\u6df1\u5165\u7684\u4e86\u89e3\u5176\u64cd\u4f5c\u539f\u7406\u3002"),(0,l.kt)("p",null,"\u9664\u4e86\u6784\u9020\u65b9\u6cd5\u4e4b\u5916\uff0c ThreadLocal\u5bf9\u5916\u66b4\u9732\u7684\u65b9\u6cd5\u6709\u4ee5\u4e0b4\u4e2a\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u65b9\u6cd5\u58f0\u660e"),(0,l.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"protected T initialValue()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u7684\u521d\u59cb\u503c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public void set( T value)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public T get()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"public void remove()"),(0,l.kt)("td",{parentName:"tr",align:null},"\u79fb\u9664\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf")))),(0,l.kt)("p",null,"\u200b\t\u4ee5\u4e0b\u662f\u8fd94\u4e2a\u65b9\u6cd5\u7684\u8be6\u7ec6\u6e90\u7801\u5206\u6790(\u4e3a\u4e86\u4fdd\u8bc1\u601d\u8def\u6e05\u6670, ThreadLocalMap\u90e8\u5206\u6682\u65f6\u4e0d\u5c55\u5f00,\u4e0b\u4e00\u4e2a\u77e5\u8bc6\u70b9\u8be6\u89e3)"),(0,l.kt)("h3",{id:"41-set\u65b9\u6cd5"},"4.1 set\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081 ) \u6e90\u7801\u548c\u5bf9\u5e94\u7684\u4e2d\u6587\u6ce8\u91ca")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"  /**\n     * \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u5bf9\u5e94\u7684ThreadLocal\u7684\u503c\n     *\n     * @param value \u5c06\u8981\u4fdd\u5b58\u5728\u5f53\u524d\u7ebf\u7a0b\u5bf9\u5e94\u7684ThreadLocal\u7684\u503c\n     */\n    public void set(T value) {\n        // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\n        Thread t = Thread.currentThread();\n        // \u83b7\u53d6\u6b64\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\u7ef4\u62a4\u7684ThreadLocalMap\u5bf9\u8c61\n        ThreadLocalMap map = getMap(t);\n        // \u5224\u65admap\u662f\u5426\u5b58\u5728\n        if (map != null)\n            // \u5b58\u5728\u5219\u8c03\u7528map.set\u8bbe\u7f6e\u6b64\u5b9e\u4f53entry\n            map.set(this, value);\n        else\n            // 1\uff09\u5f53\u524d\u7ebf\u7a0bThread \u4e0d\u5b58\u5728ThreadLocalMap\u5bf9\u8c61\n            // 2\uff09\u5219\u8c03\u7528createMap\u8fdb\u884cThreadLocalMap\u5bf9\u8c61\u7684\u521d\u59cb\u5316\n            // 3\uff09\u5e76\u5c06 t(\u5f53\u524d\u7ebf\u7a0b)\u548cvalue(t\u5bf9\u5e94\u7684\u503c)\u4f5c\u4e3a\u7b2c\u4e00\u4e2aentry\u5b58\u653e\u81f3ThreadLocalMap\u4e2d\n            createMap(t, value);\n    }\n\n /**\n     * \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0bThread\u5bf9\u5e94\u7ef4\u62a4\u7684ThreadLocalMap \n     * \n     * @param  t the current thread \u5f53\u524d\u7ebf\u7a0b\n     * @return the map \u5bf9\u5e94\u7ef4\u62a4\u7684ThreadLocalMap \n     */\n    ThreadLocalMap getMap(Thread t) {\n        return t.threadLocals;\n    }\n    /**\n     *\u521b\u5efa\u5f53\u524d\u7ebf\u7a0bThread\u5bf9\u5e94\u7ef4\u62a4\u7684ThreadLocalMap \n     *\n     * @param t \u5f53\u524d\u7ebf\u7a0b\n     * @param firstValue \u5b58\u653e\u5230map\u4e2d\u7b2c\u4e00\u4e2aentry\u7684\u503c\n     */\n    void createMap(Thread t, T firstValue) {\n        //\u8fd9\u91cc\u7684this\u662f\u8c03\u7528\u6b64\u65b9\u6cd5\u7684threadLocal\n        t.threadLocals = new ThreadLocalMap(this, firstValue);\n    }\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082 )  \u4ee3\u7801\u6267\u884c\u6d41\u7a0b")),(0,l.kt)("p",null,"\u200b\tA. \u9996\u5148\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\uff0c\u5e76\u6839\u636e\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u4e00\u4e2aMap"),(0,l.kt)("p",null,"\u200b\tB. \u5982\u679c\u83b7\u53d6\u7684Map\u4e0d\u4e3a\u7a7a\uff0c\u5219\u5c06\u53c2\u6570\u8bbe\u7f6e\u5230Map\u4e2d\uff08\u5f53\u524dThreadLocal\u7684\u5f15\u7528\u4f5c\u4e3akey\uff09"),(0,l.kt)("p",null,"\u200b\tC. \u5982\u679cMap\u4e3a\u7a7a\uff0c\u5219\u7ed9\u8be5\u7ebf\u7a0b\u521b\u5efa Map\uff0c\u5e76\u8bbe\u7f6e\u521d\u59cb\u503c"),(0,l.kt)("h3",{id:"42-get\u65b9\u6cd5"},"4.2 get\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081 ) \u6e90\u7801\u548c\u5bf9\u5e94\u7684\u4e2d\u6587\u6ce8\u91ca")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'    /**\n     * \u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e2d\u4fdd\u5b58ThreadLocal\u7684\u503c\n     * \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6ca1\u6709\u6b64ThreadLocal\u53d8\u91cf\uff0c\n     * \u5219\u5b83\u4f1a\u901a\u8fc7\u8c03\u7528{@link #initialValue} \u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316\u503c\n     *\n     * @return \u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u5bf9\u5e94\u6b64ThreadLocal\u7684\u503c\n     */\n    public T get() {\n        // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\n        Thread t = Thread.currentThread();\n        // \u83b7\u53d6\u6b64\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\u7ef4\u62a4\u7684ThreadLocalMap\u5bf9\u8c61\n        ThreadLocalMap map = getMap(t);\n        // \u5982\u679c\u6b64map\u5b58\u5728\n        if (map != null) {\n            // \u4ee5\u5f53\u524d\u7684ThreadLocal \u4e3a key\uff0c\u8c03\u7528getEntry\u83b7\u53d6\u5bf9\u5e94\u7684\u5b58\u50a8\u5b9e\u4f53e\n            ThreadLocalMap.Entry e = map.getEntry(this);\n            // \u5bf9e\u8fdb\u884c\u5224\u7a7a \n            if (e != null) {\n                @SuppressWarnings("unchecked")\n                // \u83b7\u53d6\u5b58\u50a8\u5b9e\u4f53 e \u5bf9\u5e94\u7684 value\u503c\n                // \u5373\u4e3a\u6211\u4eec\u60f3\u8981\u7684\u5f53\u524d\u7ebf\u7a0b\u5bf9\u5e94\u6b64ThreadLocal\u7684\u503c\n                T result = (T)e.value;\n                return result;\n            }\n        }\n        /*\n            \u521d\u59cb\u5316 : \u6709\u4e24\u79cd\u60c5\u51b5\u6709\u6267\u884c\u5f53\u524d\u4ee3\u7801\n            \u7b2c\u4e00\u79cd\u60c5\u51b5: map\u4e0d\u5b58\u5728\uff0c\u8868\u793a\u6b64\u7ebf\u7a0b\u6ca1\u6709\u7ef4\u62a4\u7684ThreadLocalMap\u5bf9\u8c61\n            \u7b2c\u4e8c\u79cd\u60c5\u51b5: map\u5b58\u5728, \u4f46\u662f\u6ca1\u6709\u4e0e\u5f53\u524dThreadLocal\u5173\u8054\u7684entry\n         */\n        return setInitialValue();\n    }\n\n    /**\n     * \u521d\u59cb\u5316\n     *\n     * @return the initial value \u521d\u59cb\u5316\u540e\u7684\u503c\n     */\n    private T setInitialValue() {\n        // \u8c03\u7528initialValue\u83b7\u53d6\u521d\u59cb\u5316\u7684\u503c\n        // \u6b64\u65b9\u6cd5\u53ef\u4ee5\u88ab\u5b50\u7c7b\u91cd\u5199, \u5982\u679c\u4e0d\u91cd\u5199\u9ed8\u8ba4\u8fd4\u56denull\n        T value = initialValue();\n        // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\n        Thread t = Thread.currentThread();\n        // \u83b7\u53d6\u6b64\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\u7ef4\u62a4\u7684ThreadLocalMap\u5bf9\u8c61\n        ThreadLocalMap map = getMap(t);\n        // \u5224\u65admap\u662f\u5426\u5b58\u5728\n        if (map != null)\n            // \u5b58\u5728\u5219\u8c03\u7528map.set\u8bbe\u7f6e\u6b64\u5b9e\u4f53entry\n            map.set(this, value);\n        else\n            // 1\uff09\u5f53\u524d\u7ebf\u7a0bThread \u4e0d\u5b58\u5728ThreadLocalMap\u5bf9\u8c61\n            // 2\uff09\u5219\u8c03\u7528createMap\u8fdb\u884cThreadLocalMap\u5bf9\u8c61\u7684\u521d\u59cb\u5316\n            // 3\uff09\u5e76\u5c06 t(\u5f53\u524d\u7ebf\u7a0b)\u548cvalue(t\u5bf9\u5e94\u7684\u503c)\u4f5c\u4e3a\u7b2c\u4e00\u4e2aentry\u5b58\u653e\u81f3ThreadLocalMap\u4e2d\n            createMap(t, value);\n        // \u8fd4\u56de\u8bbe\u7f6e\u7684\u503cvalue\n        return value;\n    }\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082 )  \u4ee3\u7801\u6267\u884c\u6d41\u7a0b")," "),(0,l.kt)("p",null,"\u200b\tA. \u9996\u5148\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b, \u6839\u636e\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u4e00\u4e2aMap"),(0,l.kt)("p",null,"\u200b\tB. \u5982\u679c\u83b7\u53d6\u7684Map\u4e0d\u4e3a\u7a7a\uff0c\u5219\u5728Map\u4e2d\u4ee5ThreadLocal\u7684\u5f15\u7528\u4f5c\u4e3akey\u6765\u5728Map\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684Entry e\uff0c\u5426\u5219\u8f6c\u5230D"),(0,l.kt)("p",null,"\u200b\tC. \u5982\u679ce\u4e0d\u4e3anull\uff0c\u5219\u8fd4\u56dee.value\uff0c\u5426\u5219\u8f6c\u5230D"),(0,l.kt)("p",null,"\u200b\tD. Map\u4e3a\u7a7a\u6216\u8005e\u4e3a\u7a7a\uff0c\u5219\u901a\u8fc7initialValue\u51fd\u6570\u83b7\u53d6\u521d\u59cb\u503cvalue\uff0c\u7136\u540e\u7528ThreadLocal\u7684\u5f15\u7528\u548cvalue\u4f5c\u4e3afirstKey\u548cfirstValue\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Map"),(0,l.kt)("p",null,"\u603b\u7ed3:  ",(0,l.kt)("strong",{parentName:"p"},"\u5148\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 ThreadLocalMap \u53d8\u91cf\uff0c\u5982\u679c\u5b58\u5728\u5219\u8fd4\u56de\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u5e76\u8fd4\u56de\u521d\u59cb\u503c\u3002")),(0,l.kt)("h3",{id:"43-remove\u65b9\u6cd5"},"4.3 remove\u65b9\u6cd5"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081 ) \u6e90\u7801\u548c\u5bf9\u5e94\u7684\u4e2d\u6587\u6ce8\u91ca")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," /**\n     * \u5220\u9664\u5f53\u524d\u7ebf\u7a0b\u4e2d\u4fdd\u5b58\u7684ThreadLocal\u5bf9\u5e94\u7684\u5b9e\u4f53entry\n     */\n     public void remove() {\n        // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\u7ef4\u62a4\u7684ThreadLocalMap\u5bf9\u8c61\n         ThreadLocalMap m = getMap(Thread.currentThread());\n        // \u5982\u679c\u6b64map\u5b58\u5728\n         if (m != null)\n            // \u5b58\u5728\u5219\u8c03\u7528map.remove\n            // \u4ee5\u5f53\u524dThreadLocal\u4e3akey\u5220\u9664\u5bf9\u5e94\u7684\u5b9e\u4f53entry\n             m.remove(this);\n     }\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082 )  \u4ee3\u7801\u6267\u884c\u6d41\u7a0b")),(0,l.kt)("p",null,"\u200b\tA. \u9996\u5148\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\uff0c\u5e76\u6839\u636e\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u4e00\u4e2aMap"),(0,l.kt)("p",null,"\u200b\tB. \u5982\u679c\u83b7\u53d6\u7684Map\u4e0d\u4e3a\u7a7a\uff0c\u5219\u79fb\u9664\u5f53\u524dThreadLocal\u5bf9\u8c61\u5bf9\u5e94\u7684entry"),(0,l.kt)("h3",{id:"44-initialvalue\u65b9\u6cd5"},(0,l.kt)("strong",{parentName:"h3"},"4.4 initialValue\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/**\n  * \u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u5bf9\u5e94\u7684ThreadLocal\u7684\u521d\u59cb\u503c\n  \n  * \u6b64\u65b9\u6cd5\u7684\u7b2c\u4e00\u6b21\u8c03\u7528\u53d1\u751f\u5728\uff0c\u5f53\u7ebf\u7a0b\u901a\u8fc7get\u65b9\u6cd5\u8bbf\u95ee\u6b64\u7ebf\u7a0b\u7684ThreadLocal\u503c\u65f6\n  * \u9664\u975e\u7ebf\u7a0b\u5148\u8c03\u7528\u4e86set\u65b9\u6cd5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cinitialValue \u624d\u4e0d\u4f1a\u88ab\u8fd9\u4e2a\u7ebf\u7a0b\u8c03\u7528\u3002\n  * \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u6700\u591a\u8c03\u7528\u4e00\u6b21\u8fd9\u4e2a\u65b9\u6cd5\u3002\n  *\n  * <p>\u8fd9\u4e2a\u65b9\u6cd5\u4ec5\u4ec5\u7b80\u5355\u7684\u8fd4\u56denull {@code null};\n  * \u5982\u679c\u7a0b\u5e8f\u5458\u60f3ThreadLocal\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u6709\u4e00\u4e2a\u9664null\u4ee5\u5916\u7684\u521d\u59cb\u503c\uff0c\n  * \u5fc5\u987b\u901a\u8fc7\u5b50\u7c7b\u7ee7\u627f{@code ThreadLocal} \u7684\u65b9\u5f0f\u53bb\u91cd\u5199\u6b64\u65b9\u6cd5\n  * \u901a\u5e38, \u53ef\u4ee5\u901a\u8fc7\u533f\u540d\u5185\u90e8\u7c7b\u7684\u65b9\u5f0f\u5b9e\u73b0\n  *\n  * @return \u5f53\u524dThreadLocal\u7684\u521d\u59cb\u503c\n  */\nprotected T initialValue() {\n    return null;\n}\n\n")),(0,l.kt)("p",null,"\u200b\t\u6b64\u65b9\u6cd5\u7684\u4f5c\u7528\u662f \u8fd4\u56de\u8be5\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\u7684\u521d\u59cb\u503c\u3002"),(0,l.kt)("p",null,"\uff081\uff09 \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4e00\u4e2a\u5ef6\u8fdf\u8c03\u7528\u65b9\u6cd5\uff0c\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u6211\u4eec\u5f97\u77e5\uff0c\u5728set\u65b9\u6cd5\u8fd8\u672a\u8c03\u7528\u800c\u5148\u8c03\u7528\u4e86get\u65b9\u6cd5\u65f6\u624d\u6267\u884c\uff0c\u5e76\u4e14\u4ec5\u6267\u884c1\u6b21\u3002"),(0,l.kt)("p",null,"\uff082\uff09\u8fd9\u4e2a\u65b9\u6cd5\u7f3a\u7701\u5b9e\u73b0\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"null"),"\u3002"),(0,l.kt)("p",null,"\uff083\uff09\u5982\u679c\u60f3\u8981\u4e00\u4e2a\u9664null\u4e4b\u5916\u7684\u521d\u59cb\u503c\uff0c\u53ef\u4ee5\u91cd\u5199\u6b64\u65b9\u6cd5\u3002\uff08\u5907\u6ce8\uff1a \u8be5\u65b9\u6cd5\u662f\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"p"},"protected"),"\u7684\u65b9\u6cd5\uff0c\u663e\u7136\u662f\u4e3a\u4e86\u8ba9\u5b50\u7c7b\u8986\u76d6\u800c\u8bbe\u8ba1\u7684\uff09"),(0,l.kt)("h2",{id:"5-threadlocalmap\u6e90\u7801\u5206\u6790"},"5. ThreadLocalMap\u6e90\u7801\u5206\u6790"),(0,l.kt)("p",null,"\u200b\t\u5728\u5206\u6790ThreadLocal\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e86\u89e3\u5230ThreadLocal\u7684\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u56f4\u7ed5ThreadLocalMap\u5c55\u5f00\u7684\u3002ThreadLocalMap\u7684\u6e90\u7801\u76f8\u5bf9\u6bd4\u8f83\u590d\u6742, \u6211\u4eec\u4ece\u4ee5\u4e0b\u4e09\u4e2a\u65b9\u9762\u8fdb\u884c\u8ba8\u8bba\u3002"),(0,l.kt)("h3",{id:"51-\u57fa\u672c\u7ed3\u6784"},"5.1 \u57fa\u672c\u7ed3\u6784"),(0,l.kt)("p",null,"\u200b\tThreadLocalMap\u662fThreadLocal\u7684\u5185\u90e8\u7c7b\uff0c\u6ca1\u6709\u5b9e\u73b0Map\u63a5\u53e3\uff0c\u7528\u72ec\u7acb\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86Map\u7684\u529f\u80fd\uff0c\u5176\u5185\u90e8\u7684Entry\u4e5f\u662f\u72ec\u7acb\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"   ",(0,l.kt)("img",{alt:"1574266262577",src:t(1972).Z})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081\uff09 \u6210\u5458\u53d8\u91cf")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"    /**\n     * \u521d\u59cb\u5bb9\u91cf \u2014\u2014 \u5fc5\u987b\u662f2\u7684\u6574\u6b21\u5e42\n     */\n    private static final int INITIAL_CAPACITY = 16;\n\n    /**\n     * \u5b58\u653e\u6570\u636e\u7684table\uff0cEntry\u7c7b\u7684\u5b9a\u4e49\u5728\u4e0b\u9762\u5206\u6790\n     * \u540c\u6837\uff0c\u6570\u7ec4\u957f\u5ea6\u5fc5\u987b\u662f2\u7684\u6574\u6b21\u5e42\u3002\n     */\n    private Entry[] table;\n\n    /**\n     * \u6570\u7ec4\u91cc\u9762entrys\u7684\u4e2a\u6570\uff0c\u53ef\u4ee5\u7528\u4e8e\u5224\u65adtable\u5f53\u524d\u4f7f\u7528\u91cf\u662f\u5426\u8d85\u8fc7\u9608\u503c\u3002\n     */\n    private int size = 0;\n\n    /**\n     * \u8fdb\u884c\u6269\u5bb9\u7684\u9608\u503c\uff0c\u8868\u4f7f\u7528\u91cf\u5927\u4e8e\u5b83\u7684\u65f6\u5019\u8fdb\u884c\u6269\u5bb9\u3002\n     */\n    private int threshold; // Default to 0\n    \n")),(0,l.kt)("p",null,"\u200b\t\u8ddfHashMap\u7c7b\u4f3c\uff0cINITIAL_CAPACITY\u4ee3\u8868\u8fd9\u4e2aMap\u7684\u521d\u59cb\u5bb9\u91cf\uff1btable \u662f\u4e00\u4e2aEntry \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u6570\u636e\uff1bsize \u4ee3\u8868\u8868\u4e2d\u7684\u5b58\u50a8\u6570\u76ee\uff1b threshold \u4ee3\u8868\u9700\u8981\u6269\u5bb9\u65f6\u5bf9\u5e94 size \u7684\u9608\u503c\u3002"),(0,l.kt)("p",null,"\u94fe\u63a5\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://www.jianshu.com/p/acfd2239c9f4"},"https://www.jianshu.com/p/acfd2239c9f4")),(0,l.kt)("p",null,"\u6765\u6e90\uff1a\u7b80\u4e66"),(0,l.kt)("p",null,"\u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082\uff09 \u5b58\u50a8\u7ed3\u6784 - Entry")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"/*\n * Entry\u7ee7\u627fWeakReference\uff0c\u5e76\u4e14\u7528ThreadLocal\u4f5c\u4e3akey.\n * \u5982\u679ckey\u4e3anull(entry.get() == null)\uff0c\u610f\u5473\u7740key\u4e0d\u518d\u88ab\u5f15\u7528\uff0c\n * \u56e0\u6b64\u8fd9\u65f6\u5019entry\u4e5f\u53ef\u4ee5\u4ecetable\u4e2d\u6e05\u9664\u3002\n */\nstatic class Entry extends WeakReference<ThreadLocal<?>> {\n    /** The value associated with this ThreadLocal. */\n    Object value;\n\n    Entry(ThreadLocal<?> k, Object v) {\n        super(k);\n        value = v;\n    }\n}\n")),(0,l.kt)("p",null,"\u200b\t \u5728ThreadLocalMap\u4e2d\uff0c\u4e5f\u662f\u7528Entry\u6765\u4fdd\u5b58K-V\u7ed3\u6784\u6570\u636e\u7684\u3002\u4e0d\u8fc7Entry\u4e2d\u7684key\u53ea\u80fd\u662fThreadLocal\u5bf9\u8c61\uff0c\u8fd9\u70b9\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u5df2\u7ecf\u9650\u5b9a\u6b7b\u4e86\u3002"),(0,l.kt)("p",null,"\u200b\t\u53e6\u5916\uff0cEntry\u7ee7\u627fWeakReference\uff0c\u4e5f\u5c31\u662fkey\uff08ThreadLocal\uff09\u662f\u5f31\u5f15\u7528\uff0c\u5176\u76ee\u7684\u662f\u5c06ThreadLocal\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u548c\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u89e3\u7ed1\u3002"),(0,l.kt)("h3",{id:"52-\u5f31\u5f15\u7528\u548c\u5185\u5b58\u6cc4\u6f0f"},"5.2 \u5f31\u5f15\u7528\u548c\u5185\u5b58\u6cc4\u6f0f"),(0,l.kt)("p",null,"\u200b\t\u6709\u4e9b\u7a0b\u5e8f\u5458\u5728\u4f7f\u7528ThreadLocal\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u73b0\u6709\u5185\u5b58\u6cc4\u6f0f\u7684\u60c5\u51b5\u53d1\u751f\uff0c\u5c31\u731c\u6d4b\u8fd9\u4e2a\u5185\u5b58\u6cc4\u6f0f\u8ddfEntry\u4e2d\u4f7f\u7528\u4e86\u5f31\u5f15\u7528\u7684key\u6709\u5173\u7cfb\u3002\u8fd9\u4e2a\u7406\u89e3\u5176\u5b9e\u662f\u4e0d\u5bf9\u7684\u3002"),(0,l.kt)("p",null,"\u200b\t\u6211\u4eec\u5148\u6765\u56de\u987e\u8fd9\u4e2a\u95ee\u9898\u4e2d\u6d89\u53ca\u7684\u51e0\u4e2a\u540d\u8bcd\u6982\u5ff5\uff0c\u518d\u6765\u5206\u6790\u95ee\u9898\u3002"),(0,l.kt)("p",null,"   ",(0,l.kt)("strong",{parentName:"p"},"\uff081\uff09 \u5185\u5b58\u6cc4\u6f0f\u76f8\u5173\u6982\u5ff5")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Memory overflow:\u5185\u5b58\u6ea2\u51fa\uff0c\u6ca1\u6709\u8db3\u591f\u7684\u5185\u5b58\u63d0\u4f9b\u7533\u8bf7\u8005\u4f7f\u7528\u3002"),(0,l.kt)("li",{parentName:"ul"},"Memory leak: \u5185\u5b58\u6cc4\u6f0f\u662f\u6307\u7a0b\u5e8f\u4e2d\u5df1\u52a8\u6001\u5206\u914d\u7684\u5806\u5185\u5b58\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u7a0b\u5e8f\u672a\u91ca\u653e\u6216\u65e0\u6cd5\u91ca\u653e\uff0c\u9020\u6210\u7cfb\u7edf\u5185\u5b58\u7684\u6d6a\u8d39\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u8fd0\u884c\u901f\u5ea6\u51cf\u6162\u751a\u81f3\u7cfb\u7edf\u5d29\u6e83\u7b49\u4e25\u91cd\u540e\u679c\u3002\u5185\u5b58\u6cc4\u6f0f\u7684\u5806\u79ef\u7ec8\u5c06\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002\t")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082\uff09  \u5f31\u5f15\u7528\u76f8\u5173\u6982\u5ff5")),(0,l.kt)("p",null,"\u200b\tJava\u4e2d\u7684\u5f15\u7528\u67094\u79cd\u7c7b\u578b\uff1a \u5f3a\u3001\u8f6f\u3001\u5f31\u3001\u865a\u3002\u5f53\u524d\u8fd9\u4e2a\u95ee\u9898\u4e3b\u8981\u6d89\u53ca\u5230\u5f3a\u5f15\u7528\u548c\u5f31\u5f15\u7528\uff1a"),(0,l.kt)("p",null,"\u200b\t",(0,l.kt)("strong",{parentName:"p"},"\u5f3a\u5f15\u7528\uff08\u201cStrong\u201d Reference\uff09"),"\uff0c\u5c31\u662f\u6211\u4eec\u6700\u5e38\u89c1\u7684\u666e\u901a\u5bf9\u8c61\u5f15\u7528\uff0c\u53ea\u8981\u8fd8\u6709\u5f3a\u5f15\u7528\u6307\u5411\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c31\u80fd\u8868\u660e\u5bf9\u8c61\u8fd8\u201c\u6d3b\u7740\u201d\uff0c\u5783\u573e\u56de\u6536\u5668\u5c31\u4e0d\u4f1a\u56de\u6536\u8fd9\u79cd\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u200b\t",(0,l.kt)("strong",{parentName:"p"},"\u5f31\u5f15\u7528\uff08WeakReference\uff09"),"\uff0c\u5783\u573e\u56de\u6536\u5668\u4e00\u65e6\u53d1\u73b0\u4e86\u53ea\u5177\u6709\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u5f53\u524d\u5185\u5b58\u7a7a\u95f4\u8db3\u591f\u4e0e\u5426\uff0c\u90fd\u4f1a\u56de\u6536\u5b83\u7684\u5185\u5b58\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff083\uff09 \u5982\u679ckey\u4f7f\u7528\u5f3a\u5f15\u7528")),(0,l.kt)("p",null,"\u200b\t\u5047\u8bbeThreadLocalMap\u4e2d\u7684key\u4f7f\u7528\u4e86\u5f3a\u5f15\u7528\uff0c\u90a3\u4e48\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u5417\uff1f"),(0,l.kt)("p",null,"\u200b\t\u6b64\u65f6ThreadLocal\u7684\u5185\u5b58\u56fe\uff08\u5b9e\u7ebf\u8868\u793a\u5f3a\u5f15\u7528\uff09\u5982\u4e0b\uff1a "),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1582902708234",src:t(913).Z})),(0,l.kt)("p",null,"\u200b\t\u5047\u8bbe\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b8cThreadLocal \uff0cthreadLocal Ref\u88ab\u56de\u6536\u4e86\u3002"),(0,l.kt)("p",null,"\u200b\t\u4f46\u662f\u56e0\u4e3athreadLocalMap\u7684Entry\u5f3a\u5f15\u7528\u4e86threadLocal\uff0c\u9020\u6210threadLocal\u65e0\u6cd5\u88ab\u56de\u6536\u3002"),(0,l.kt)("p",null,"\u200b\t\u5728\u6ca1\u6709\u624b\u52a8\u5220\u9664\u8fd9\u4e2aEntry\u4ee5\u53caCurrentThread\u4f9d\u7136\u8fd0\u884c\u7684\u524d\u63d0\u4e0b\uff0c\u59cb\u7ec8\u6709\u5f3a\u5f15\u7528\u94fe threadRef->currentThread->threadLocalMap->entry\uff0cEntry\u5c31\u4e0d\u4f1a\u88ab\u56de\u6536\uff08Entry\u4e2d\u5305\u62ec\u4e86ThreadLocal\u5b9e\u4f8b\u548cvalue\uff09\uff0c\u5bfc\u81f4Entry\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,"\u200b\t\u4e5f\u5c31\u662f\u8bf4\uff0cThreadLocalMap\u4e2d\u7684key\u4f7f\u7528\u4e86\u5f3a\u5f15\u7528\uff0c \u662f\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u7684\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff085\uff09\u5982\u679ckey\u4f7f\u7528\u5f31\u5f15\u7528")),(0,l.kt)("p",null,"\u200b\t\u90a3\u4e48ThreadLocalMap\u4e2d\u7684key\u4f7f\u7528\u4e86\u5f31\u5f15\u7528\uff0c\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u5417\uff1f"),(0,l.kt)("p",null,"\u200b\t\u6b64\u65f6ThreadLocal\u7684\u5185\u5b58\u56fe\uff08\u5b9e\u7ebf\u8868\u793a\u5f3a\u5f15\u7528\uff0c\u865a\u7ebf\u8868\u793a\u5f31\u5f15\u7528\uff09\u5982\u4e0b\uff1a "),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"1582907143471",src:t(2087).Z})),(0,l.kt)("p",null,"\u200b\t"),(0,l.kt)("p",null,"\u200b\t\u540c\u6837\u5047\u8bbe\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b8cThreadLocal \uff0cthreadLocal Ref\u88ab\u56de\u6536\u4e86\u3002"),(0,l.kt)("p",null,"\u200b\t\u7531\u4e8eThreadLocalMap\u53ea\u6301\u6709ThreadLocal\u7684\u5f31\u5f15\u7528\uff0c\u6ca1\u6709\u4efb\u4f55\u5f3a\u5f15\u7528\u6307\u5411threadlocal\u5b9e\u4f8b, \u6240\u4ee5threadlocal\u5c31\u53ef\u4ee5\u987a\u5229\u88abgc\u56de\u6536\uff0c\u6b64\u65f6Entry\u4e2d\u7684key=null\u3002"),(0,l.kt)("p",null,"\u200b\t\u4f46\u662f\u5728\u6ca1\u6709\u624b\u52a8\u5220\u9664\u8fd9\u4e2aEntry\u4ee5\u53caCurrentThread\u4f9d\u7136\u8fd0\u884c\u7684\u524d\u63d0\u4e0b\uff0c\u4e5f\u5b58\u5728\u6709\u5f3a\u5f15\u7528\u94fe threadRef->currentThread->threadLocalMap->entry -> value \uff0cvalue\u4e0d\u4f1a\u88ab\u56de\u6536\uff0c \u800c\u8fd9\u5757value\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\u4e86\uff0c\u5bfc\u81f4value\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,"\u200b\t\u4e5f\u5c31\u662f\u8bf4\uff0cThreadLocalMap\u4e2d\u7684key\u4f7f\u7528\u4e86\u5f31\u5f15\u7528\uff0c \u4e5f\u6709\u53ef\u80fd\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff086\uff09\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u7684\u771f\u5b9e\u539f\u56e0")),(0,l.kt)("p",null,"\u200b\t\u6bd4\u8f83\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0\uff0c\u5185\u5b58\u6cc4\u6f0f\u7684\u53d1\u751f\u8ddfThreadLocalMap\u4e2d\u7684key\u662f\u5426\u4f7f\u7528\u5f31\u5f15\u7528\u662f\u6ca1\u6709\u5173\u7cfb\u7684\u3002\u90a3\u4e48\u5185\u5b58\u6cc4\u6f0f\u7684\u7684\u771f\u6b63\u539f\u56e0\u662f\u4ec0\u4e48\u5462\uff1f"),(0,l.kt)("p",null,"\u200b\t\u7ec6\u5fc3\u7684\u540c\u5b66\u4f1a\u53d1\u73b0\uff0c\u5728\u4ee5\u4e0a\u4e24\u79cd\u5185\u5b58\u6cc4\u6f0f\u7684\u60c5\u51b5\u4e2d\uff0c\u90fd\u6709\u4e24\u4e2a\u524d\u63d0\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6ca1\u6709\u624b\u52a8\u5220\u9664\u8fd9\u4e2aEntry"),(0,l.kt)("li",{parentName:"ol"},"CurrentThread\u4f9d\u7136\u8fd0\u884c")),(0,l.kt)("p",null,"\u200b        \u7b2c\u4e00\u70b9\u5f88\u597d\u7406\u89e3\uff0c\u53ea\u8981\u5728\u4f7f\u7528\u5b8cThreadLocal\uff0c\u8c03\u7528\u5176remove\u65b9\u6cd5\u5220\u9664\u5bf9\u5e94\u7684Entry\uff0c\u5c31\u80fd\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,"\u200b\t\u7b2c\u4e8c\u70b9\u7a0d\u5fae\u590d\u6742\u4e00\u70b9\uff0c \u7531\u4e8eThreadLocalMap\u662fThread\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u88ab\u5f53\u524d\u7ebf\u7a0b\u6240\u5f15\u7528\uff0c\u6240\u4ee5\u5b83\u7684\u751f\u547d\u5468\u671f\u8ddfThread\u4e00\u6837\u957f\u3002\u90a3\u4e48\u5728\u4f7f\u7528\u5b8cThreadLocal\u7684\u4f7f\u7528\uff0c\u5982\u679c\u5f53\u524dThread\u4e5f\u968f\u4e4b\u6267\u884c\u7ed3\u675f\uff0cThreadLocalMap\u81ea\u7136\u4e5f\u4f1a\u88abgc\u56de\u6536\uff0c\u4ece\u6839\u6e90\u4e0a\u907f\u514d\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,"\u200b\t\u7efc\u4e0a\uff0c",(0,l.kt)("strong",{parentName:"p"},"ThreadLocal\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\u662f"),"\uff1a\u7531\u4e8eThreadLocalMap\u7684\u751f\u547d\u5468\u671f\u8ddfThread\u4e00\u6837\u957f\uff0c\u5982\u679c\u6ca1\u6709\u624b\u52a8\u5220\u9664\u5bf9\u5e94key\u5c31\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff087\uff09 \u4e3a\u4ec0\u4e48\u4f7f\u7528\u5f31\u5f15\u7528")),(0,l.kt)("p",null,"\u200b\t\u6839\u636e\u521a\u624d\u7684\u5206\u6790, \u6211\u4eec\u77e5\u9053\u4e86\uff1a \u65e0\u8bbaThreadLocalMap\u4e2d\u7684key\u4f7f\u7528\u54ea\u79cd\u7c7b\u578b\u5f15\u7528\u90fd\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\uff0c\u8ddf\u4f7f\u7528\u5f31\u5f15\u7528\u6ca1\u6709\u5173\u7cfb\u3002"),(0,l.kt)("p",null,"\u200b\t\u8981\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5b8cThreadLocal\uff0c\u8c03\u7528\u5176remove\u65b9\u6cd5\u5220\u9664\u5bf9\u5e94\u7684Entry")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5b8cThreadLocal\uff0c\u5f53\u524dThread\u4e5f\u968f\u4e4b\u8fd0\u884c\u7ed3\u675f"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"\u76f8\u5bf9\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff0c\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u663e\u7136\u66f4\u4e0d\u597d\u63a7\u5236\uff0c\u7279\u522b\u662f\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u7ed3\u675f\u662f\u4e0d\u4f1a\u9500\u6bc1\u7684\u3002\n")),(0,l.kt)("p",null,"\u200b\t\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u8981\u8bb0\u5f97\u5728\u4f7f\u7528\u5b8cThreadLocal\u53ca\u65f6\u7684\u8c03\u7528remove\uff0c\u65e0\u8bbakey\u662f\u5f3a\u5f15\u7528\u8fd8\u662f\u5f31\u5f15\u7528\u90fd\u4e0d\u4f1a\u6709\u95ee\u9898\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48key\u8981\u7528\u5f31\u5f15\u7528\u5462\uff1f"),(0,l.kt)("p",null,"\u200b\t\u4e8b\u5b9e\u4e0a\uff0c\u5728ThreadLocalMap\u4e2d\u7684set/getEntry\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u5bf9key\u4e3anull\uff08\u4e5f\u5373\u662fThreadLocal\u4e3anull\uff09\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u4e3anull\u7684\u8bdd\uff0c\u90a3\u4e48\u662f\u4f1a\u5bf9value\u7f6e\u4e3anull\u7684\u3002"),(0,l.kt)("p",null,"\u200b\t\u8fd9\u5c31\u610f\u5473\u7740\u4f7f\u7528\u5b8cThreadLocal\uff0cCurrentThread\u4f9d\u7136\u8fd0\u884c\u7684\u524d\u63d0\u4e0b\uff0c\u5c31\u7b97\u5fd8\u8bb0\u8c03\u7528remove\u65b9\u6cd5\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u5f31\u5f15\u7528\u6bd4\u5f3a\u5f15\u7528\u53ef\u4ee5\u591a\u4e00\u5c42\u4fdd\u969c"),"\uff1a\u5f31\u5f15\u7528\u7684ThreadLocal\u4f1a\u88ab\u56de\u6536\uff0c\u5bf9\u5e94\u7684value\u5728\u4e0b\u4e00\u6b21ThreadLocalMap\u8c03\u7528set,get,remove\u4e2d\u7684\u4efb\u4e00\u65b9\u6cd5\u7684\u65f6\u5019\u4f1a\u88ab\u6e05\u9664\uff0c\u4ece\u800c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("h3",{id:"53-hash\u51b2\u7a81\u7684\u89e3\u51b3"},"5.3 hash\u51b2\u7a81\u7684\u89e3\u51b3"),(0,l.kt)("p",null,"\u200b\thash\u51b2\u7a81\u7684\u89e3\u51b3\u662fMap\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u5185\u5bb9\u3002\u6211\u4eec\u4ee5hash\u51b2\u7a81\u7684\u89e3\u51b3\u4e3a\u7ebf\u7d22\uff0c\u6765\u7814\u7a76\u4e00\u4e0bThreadLocalMap\u7684\u6838\u5fc3\u6e90\u7801\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff081\uff09 \u9996\u5148\u4eceThreadLocal\u7684set() \u65b9\u6cd5\u5165\u624b")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"  public void set(T value) {\n        Thread t = Thread.currentThread();\n        ThreadLocal.ThreadLocalMap map = getMap(t);\n        if (map != null)\n            //\u8c03\u7528\u4e86ThreadLocalMap\u7684set\u65b9\u6cd5\n            map.set(this, value);\n        else\n            createMap(t, value);\n    }\n    \n    ThreadLocal.ThreadLocalMap getMap(Thread t) {\n        return t.threadLocals;\n    }\n\n    void createMap(Thread t, T firstValue) {\n            //\u8c03\u7528\u4e86ThreadLocalMap\u7684\u6784\u9020\u65b9\u6cd5\n        t.threadLocals = new ThreadLocal.ThreadLocalMap(this, firstValue);\n    }\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u65b9\u6cd5\u6211\u4eec\u521a\u624d\u5206\u6790\u8fc7, \u5176\u4f5c\u7528\u662f\u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u7ed1\u5b9a\u7684\u5c40\u90e8\u53d8\u91cf : "),(0,l.kt)("p",null,"\u200b\tA. \u9996\u5148\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\uff0c\u5e76\u6839\u636e\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u4e00\u4e2aMap"),(0,l.kt)("p",null,"\u200b\tB. \u5982\u679c\u83b7\u53d6\u7684Map\u4e0d\u4e3a\u7a7a\uff0c\u5219\u5c06\u53c2\u6570\u8bbe\u7f6e\u5230Map\u4e2d\uff08\u5f53\u524dThreadLocal\u7684\u5f15\u7528\u4f5c\u4e3akey\uff09"),(0,l.kt)("p",null,"\u200b\t\t",(0,l.kt)("strong",{parentName:"p"},"(\u8fd9\u91cc\u8c03\u7528\u4e86ThreadLocalMap\u7684set\u65b9\u6cd5)")),(0,l.kt)("p",null,"\u200b\tC. \u5982\u679cMap\u4e3a\u7a7a\uff0c\u5219\u7ed9\u8be5\u7ebf\u7a0b\u521b\u5efa Map\uff0c\u5e76\u8bbe\u7f6e\u521d\u59cb\u503c"),(0,l.kt)("p",null,"\u200b\t\t",(0,l.kt)("strong",{parentName:"p"},"(\u8fd9\u91cc\u8c03\u7528\u4e86ThreadLocalMap\u7684\u6784\u9020\u65b9\u6cd5)")),(0,l.kt)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u6709\u4e24\u4e2a\u5730\u65b9\u5206\u522b\u6d89\u53ca\u5230ThreadLocalMap\u7684\u4e24\u4e2a\u65b9\u6cd5, \u6211\u4eec\u63a5\u7740\u5206\u6790\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff082\uff09\u6784\u9020\u65b9\u6cd5`ThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue)"),"`"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"}," /*\n  * firstKey : \u672cThreadLocal\u5b9e\u4f8b(this)\n  * firstValue \uff1a \u8981\u4fdd\u5b58\u7684\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\n  */\nThreadLocalMap(ThreadLocal<?> firstKey, Object firstValue) {\n        //\u521d\u59cb\u5316table\n        table = new ThreadLocal.ThreadLocalMap.Entry[INITIAL_CAPACITY];\n        //\u8ba1\u7b97\u7d22\u5f15(\u91cd\u70b9\u4ee3\u7801\uff09\n        int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1);\n        //\u8bbe\u7f6e\u503c\n        table[i] = new ThreadLocal.ThreadLocalMap.Entry(firstKey, firstValue);\n        size = 1;\n        //\u8bbe\u7f6e\u9608\u503c\n        setThreshold(INITIAL_CAPACITY);\n    }\n")),(0,l.kt)("p",null,"\u200b\t\u6784\u9020\u51fd\u6570\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a16\u7684Entry\u6570\u7ec4\uff0c\u7136\u540e\u8ba1\u7b97\u51fafirstKey\u5bf9\u5e94\u7684\u7d22\u5f15\uff0c\u7136\u540e\u5b58\u50a8\u5230table\u4e2d\uff0c\u5e76\u8bbe\u7f6esize\u548cthreshold\u3002"),(0,l.kt)("p",null,"\u200b\t",(0,l.kt)("strong",{parentName:"p"},"\u91cd\u70b9\u5206\u6790"),"\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"int i = firstKey.threadLocalHashCode & (INITIAL_CAPACITY - 1)"),"\u3002"),(0,l.kt)("p",null,"a. \u5173\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"firstKey.threadLocalHashCode"),"\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"    private final int threadLocalHashCode = nextHashCode();\n    \n    private static int nextHashCode() {\n        return nextHashCode.getAndAdd(HASH_INCREMENT);\n    }\n//AtomicInteger\u662f\u4e00\u4e2a\u63d0\u4f9b\u539f\u5b50\u64cd\u4f5c\u7684Integer\u7c7b\uff0c\u901a\u8fc7\u7ebf\u7a0b\u5b89\u5168\u7684\u65b9\u5f0f\u64cd\u4f5c\u52a0\u51cf,\u9002\u5408\u9ad8\u5e76\u53d1\u60c5\u51b5\u4e0b\u7684\u4f7f\u7528\n    private static AtomicInteger nextHashCode =  new AtomicInteger();\n     //\u7279\u6b8a\u7684hash\u503c\n    private static final int HASH_INCREMENT = 0x61c88647;\n")),(0,l.kt)("p",null,"\u200b\t\u8fd9\u91cc\u5b9a\u4e49\u4e86\u4e00\u4e2aAtomicInteger\u7c7b\u578b\uff0c\u6bcf\u6b21\u83b7\u53d6\u5f53\u524d\u503c\u5e76\u52a0\u4e0aHASH_INCREMENT\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"HASH_INCREMENT = 0x61c88647"),",\u8fd9\u4e2a\u503c\u8ddf\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff08\u9ec4\u91d1\u5206\u5272\u6570\uff09\u6709\u5173\uff0c\u5176\u4e3b\u8981\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u8ba9\u54c8\u5e0c\u7801\u80fd\u5747\u5300\u7684\u5206\u5e03\u57282\u7684n\u6b21\u65b9\u7684\u6570\u7ec4\u91cc, \u4e5f\u5c31\u662fEntry[] table\u4e2d\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u5c3d\u91cf\u907f\u514dhash\u51b2\u7a81\u3002"),(0,l.kt)("p",null,"b. \u5173\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"& (INITIAL_CAPACITY - 1)")),(0,l.kt)("p",null,"\u200b\t\u8ba1\u7b97hash\u7684\u65f6\u5019\u91cc\u9762\u91c7\u7528\u4e86hashCode & (size - 1)\u7684\u7b97\u6cd5\uff0c\u8fd9\u76f8\u5f53\u4e8e\u53d6\u6a21\u8fd0\u7b97hashCode % size\u7684\u4e00\u4e2a\u66f4\u9ad8\u6548\u7684\u5b9e\u73b0\u3002\u6b63\u662f\u56e0\u4e3a\u8fd9\u79cd\u7b97\u6cd5\uff0c\u6211\u4eec\u8981\u6c42size\u5fc5\u987b\u662f2\u7684\u6574\u6b21\u5e42\uff0c\u8fd9\u4e5f\u80fd\u4fdd\u8bc1\u5728\u7d22\u5f15\u4e0d\u8d8a\u754c\u7684\u524d\u63d0\u4e0b\uff0c\u4f7f\u5f97hash\u53d1\u751f\u51b2\u7a81\u7684\u6b21\u6570\u51cf\u5c0f\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\uff083\uff09 ThreadLocalMap\u4e2d\u7684set\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"private void set(ThreadLocal<?> key, Object value) {\n        ThreadLocal.ThreadLocalMap.Entry[] tab = table;\n        int len = tab.length;\n        //\u8ba1\u7b97\u7d22\u5f15(\u91cd\u70b9\u4ee3\u7801\uff0c\u521a\u624d\u5206\u6790\u8fc7\u4e86\uff09\n        int i = key.threadLocalHashCode & (len-1);\n        /**\n         * \u4f7f\u7528\u7ebf\u6027\u63a2\u6d4b\u6cd5\u67e5\u627e\u5143\u7d20\uff08\u91cd\u70b9\u4ee3\u7801\uff09\n         */\n        for (ThreadLocal.ThreadLocalMap.Entry e = tab[i];\n             e != null;\n             e = tab[i = nextIndex(i, len)]) {\n            ThreadLocal<?> k = e.get();\n            //ThreadLocal \u5bf9\u5e94\u7684 key \u5b58\u5728\uff0c\u76f4\u63a5\u8986\u76d6\u4e4b\u524d\u7684\u503c\n            if (k == key) {\n                e.value = value;\n                return;\n            }\n            // key\u4e3a null\uff0c\u4f46\u662f\u503c\u4e0d\u4e3a null\uff0c\u8bf4\u660e\u4e4b\u524d\u7684 ThreadLocal \u5bf9\u8c61\u5df2\u7ecf\u88ab\u56de\u6536\u4e86\uff0c\n           // \u5f53\u524d\u6570\u7ec4\u4e2d\u7684 Entry \u662f\u4e00\u4e2a\u9648\u65e7\uff08stale\uff09\u7684\u5143\u7d20\n            if (k == null) {\n                //\u7528\u65b0\u5143\u7d20\u66ff\u6362\u9648\u65e7\u7684\u5143\u7d20\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8fdb\u884c\u4e86\u4e0d\u5c11\u7684\u5783\u573e\u6e05\u7406\u52a8\u4f5c\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\n                replaceStaleEntry(key, value, i);\n                return;\n            }\n        }\n    \n        //ThreadLocal\u5bf9\u5e94\u7684key\u4e0d\u5b58\u5728\u5e76\u4e14\u6ca1\u6709\u627e\u5230\u9648\u65e7\u7684\u5143\u7d20\uff0c\u5219\u5728\u7a7a\u5143\u7d20\u7684\u4f4d\u7f6e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Entry\u3002\n            tab[i] = new Entry(key, value);\n            int sz = ++size;\n            /**\n             * cleanSomeSlots\u7528\u4e8e\u6e05\u9664\u90a3\u4e9be.get()==null\u7684\u5143\u7d20\uff0c\n             * \u8fd9\u79cd\u6570\u636ekey\u5173\u8054\u7684\u5bf9\u8c61\u5df2\u7ecf\u88ab\u56de\u6536\uff0c\u6240\u4ee5\u8fd9\u4e2aEntry(table[index])\u53ef\u4ee5\u88ab\u7f6enull\u3002\n             * \u5982\u679c\u6ca1\u6709\u6e05\u9664\u4efb\u4f55entry,\u5e76\u4e14\u5f53\u524d\u4f7f\u7528\u91cf\u8fbe\u5230\u4e86\u8d1f\u8f7d\u56e0\u5b50\u6240\u5b9a\u4e49(\u957f\u5ea6\u76842/3)\uff0c\u90a3\u4e48\u8fdb\u884c              * rehash\uff08\u6267\u884c\u4e00\u6b21\u5168\u8868\u7684\u626b\u63cf\u6e05\u7406\u5de5\u4f5c\uff09\n             */\n            if (!cleanSomeSlots(i, sz) && sz >= threshold)\n                rehash();\n}\n\n /**\n     * \u83b7\u53d6\u73af\u5f62\u6570\u7ec4\u7684\u4e0b\u4e00\u4e2a\u7d22\u5f15\n     */\n    private static int nextIndex(int i, int len) {\n        return ((i + 1 < len) ? i + 1 : 0);\n    }\n\n")),(0,l.kt)("p",null,"\u200b\t\u4ee3\u7801\u6267\u884c\u6d41\u7a0b\uff1a"),(0,l.kt)("p",null,"A. \u9996\u5148\u8fd8\u662f\u6839\u636ekey\u8ba1\u7b97\u51fa\u7d22\u5f15 i\uff0c\u7136\u540e\u67e5\u627ei\u4f4d\u7f6e\u4e0a\u7684Entry\uff0c"),(0,l.kt)("p",null,"B. \u82e5\u662fEntry\u5df2\u7ecf\u5b58\u5728\u5e76\u4e14key\u7b49\u4e8e\u4f20\u5165\u7684key\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u76f4\u63a5\u7ed9\u8fd9\u4e2aEntry\u8d4b\u65b0\u7684value\u503c,"),(0,l.kt)("p",null,"C. \u82e5\u662fEntry\u5b58\u5728\uff0c\u4f46\u662fkey\u4e3anull\uff0c\u5219\u8c03\u7528replaceStaleEntry\u6765\u66f4\u6362\u8fd9\u4e2akey\u4e3a\u7a7a\u7684Entry,"),(0,l.kt)("p",null,"D. \u4e0d\u65ad\u5faa\u73af\u68c0\u6d4b\uff0c\u76f4\u5230\u9047\u5230\u4e3anull\u7684\u5730\u65b9\uff0c\u8fd9\u65f6\u5019\u8981\u662f\u8fd8\u6ca1\u5728\u5faa\u73af\u8fc7\u7a0b\u4e2dreturn\uff0c\u90a3\u4e48\u5c31\u5728\u8fd9\u4e2anull\u7684\u4f4d\u7f6e\u65b0\u5efa\u4e00\u4e2aEntry\uff0c\u5e76\u4e14\u63d2\u5165\uff0c\u540c\u65f6size\u589e\u52a01\u3002"),(0,l.kt)("p",null,"\u200b    \u6700\u540e\u8c03\u7528cleanSomeSlots\uff0c\u6e05\u7406key\u4e3anull\u7684Entry\uff0c\u6700\u540e\u8fd4\u56de\u662f\u5426\u6e05\u7406\u4e86Entry\uff0c\u63a5\u4e0b\u6765\u518d\u5224\u65adsz \u662f\u5426>= thresgold\u8fbe\u5230\u4e86rehash\u7684\u6761\u4ef6\uff0c\u8fbe\u5230\u7684\u8bdd\u5c31\u4f1a\u8c03\u7528rehash\u51fd\u6570\u6267\u884c\u4e00\u6b21\u5168\u8868\u7684\u626b\u63cf\u6e05\u7406\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u91cd\u70b9\u5206\u6790")," \uff1a ThreadLocalMap\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"\u7ebf\u6027\u63a2\u6d4b\u6cd5"),"\u6765\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u3002"),(0,l.kt)("p",null,"\u200b\t\u8be5\u65b9\u6cd5\u4e00\u6b21\u63a2\u6d4b\u4e0b\u4e00\u4e2a\u5730\u5740\uff0c\u76f4\u5230\u6709\u7a7a\u7684\u5730\u5740\u540e\u63d2\u5165\uff0c\u82e5\u6574\u4e2a\u7a7a\u95f4\u90fd\u627e\u4e0d\u5230\u7a7a\u4f59\u7684\u5730\u5740\uff0c\u5219\u4ea7\u751f\u6ea2\u51fa\u3002"),(0,l.kt)("p",null,"\u200b\t\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u5f53\u524dtable\u957f\u5ea6\u4e3a16\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u8ba1\u7b97\u51fa\u6765key\u7684hash\u503c\u4e3a14\uff0c\u5982\u679ctable","[14]","\u4e0a\u5df2\u7ecf\u6709\u503c\uff0c\u5e76\u4e14\u5176key\u4e0e\u5f53\u524dkey\u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u5c31\u53d1\u751f\u4e86hash\u51b2\u7a81\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c0614\u52a01\u5f97\u523015\uff0c\u53d6table","[15]","\u8fdb\u884c\u5224\u65ad\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u8fd8\u662f\u51b2\u7a81\u4f1a\u56de\u52300\uff0c\u53d6table","[0]",",\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u53ef\u4ee5\u63d2\u5165\u3002"),(0,l.kt)("p",null,"\u200b\t\u6309\u7167\u4e0a\u9762\u7684\u63cf\u8ff0\uff0c\u53ef\u4ee5\u628aEntry[]  table\u770b\u6210\u4e00\u4e2a\u73af\u5f62\u6570\u7ec4\u3002"))}u.isMDXComponent=!0},2452:function(n,e,t){"use strict";e.Z=t.p+"assets/files/\u7ebf\u7a0b\u6c60\u7814\u53d1\u8bb2\u4e49-c36d8f70fb08410647a69a519a59fb2b.ppt"},8456:function(n,e,t){"use strict";e.Z=t.p+"assets/files/\u90d1\u5dde\u6821\u533a-\u5f20\u5b66\u5168-\u7ebf\u7a0b\u6c60\u7814\u53d1\u5927\u7eb2_v2019-11-21-1846fbb08701862c9968c2bebcd128d3.xmind"},4199:function(n,e,t){"use strict";e.Z=t.p+"assets/images/001-e20d5ba40a5987df78480d223727b2b0.png"},2426:function(n,e){"use strict";e.Z="data:image/png;base64,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"},9204:function(n,e){"use strict";e.Z="data:image/png;base64,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"},9361:function(n,e,t){"use strict";e.Z=t.p+"assets/images/004-2a884ca053576188ab7732799ad25317.png"},1972:function(n,e,t){"use strict";e.Z=t.p+"assets/images/005-bd5310f31ddcbbcab43b2327a98d1bd1.png"},2087:function(n,e,t){"use strict";e.Z=t.p+"assets/images/006-8f4acb712ce6ce325bdf8b9384a0f664.png"},9683:function(n,e){"use strict";e.Z="data:image/png;base64,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"},4033:function(n,e,t){"use strict";e.Z=t.p+"assets/images/008-54cdede3f8dbbbc835d89c6111d34b07.png"},913:function(n,e,t){"use strict";e.Z=t.p+"assets/images/009-6e8b78b158a71b91f2bb6c7d39d9ac59.png"}}]);